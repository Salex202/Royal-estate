{% include 'partials/header.html' %}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Occupied Properties</h1>
        <div>
            <a href="{{ url_for('vacant_properties') }}" class="btn btn-success me-2">
                <i class="fas fa-home"></i> Vacant Properties
            </a>
            <a href="{{ url_for('properties_list') }}" class="btn btn-primary">
                <i class="fas fa-list"></i> All Properties
            </a>
        </div>
    </div>

    <div class="row">
        <!-- 1️⃣ Occupied standalone properties -->
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Occupied Standalone Properties</h6>
                </div>
                <div class="card-body">
                    {% if occupied_properties %}
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Type</th>
                                        <th>Location</th>
                                        <th>Tenant</th>
                                        <th>Landlord</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for property in occupied_properties %}
                                        <tr>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=property.id) }}">
                                                    {{ property.title }}
                                                </a>
                                            </td>
                                            <td>{{ property.type }}</td>
                                            <td>{{ property.location }}</td>
                                            <td>
                                                {% if property.tenant_id %}
                                                    <a href="{{ url_for('tenant_detail', tenant_id=property.tenant_id) }}">
                                                        {{ property.tenant_name }}
                                                    </a>
                                                {% else %}
                                                    <span class="text-muted">No Tenant Linked</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ property.landlord_name }}</td>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=property.id) }}" class="btn btn-info btn-sm">
                                                    <i class="fas fa-eye"></i> Details
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">No occupied standalone properties found.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- 2️⃣ Properties with occupied units -->
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Properties with Occupied Units</h6>
                </div>
                <div class="card-body">
                    {% if properties_with_occupied_units %}
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Property</th>
                                        <th>Location</th>
                                        <th>Landlord</th>
                                        <th>Occupancy</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for property in properties_with_occupied_units %}
                                        <tr>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=property.id) }}">{{ property.title }}</a>
                                            </td>
                                            <td>{{ property.location }}</td>
                                            <td>{{ property.landlord_name }}</td>
                                            <td>
                                                <span class="badge {% if property.occupied_units == property.total_units %}bg-danger{% else %}bg-warning{% endif %}">
                                                    {{ property.occupied_units }}/{{ property.total_units }} Occupied
                                                </span>
                                            </td>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=property.id) }}" class="btn btn-info btn-sm">
                                                    <i class="fas fa-eye"></i> Details
                                                </a>
                                                {% if property.occupied_units < property.total_units %}
                                                    <button class="btn btn-success btn-sm rent-btn"
                                                            data-property-id="{{ property.id }}"
                                                            data-property-type="multi">
                                                        <i class="fas fa-key"></i> Rent Unit
                                                    </button>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">No properties with occupied units.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- 3️⃣ Occupied units -->
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Occupied Individual Units</h6>
                </div>
                <div class="card-body">
                    {% if occupied_units %}
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Unit</th>
                                        <th>Property</th>
                                        <th>Tenant</th>
                                        <th>Landlord</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for unit in occupied_units %}
                                        <tr>
                                            <td>{{ unit.unit_name }}</td>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=unit.property_id) }}">
                                                    {{ unit.property_title }}
                                                </a>
                                            </td>
                                            <td>
                                                {% if unit.tenant_id %}
                                                    <a href="{{ url_for('tenant_detail', tenant_id=unit.tenant_id) }}">
                                                        {{ unit.tenant_name }}
                                                    </a>
                                                {% else %}
                                                    <span class="text-muted">No Tenant Linked</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ unit.landlord_name }}</td>
                                            <td>
                                                <a href="{{ url_for('property_detail', property_id=unit.property_id) }}" class="btn btn-info btn-sm">
                                                    <i class="fas fa-eye"></i> Details
                                                </a>
                                                {% if unit.tenant_id %}
                                                    <a href="{{ url_for('tenant_detail', tenant_id=unit.tenant_id) }}" class="btn btn-primary btn-sm">
                                                        <i class="fas fa-user"></i> Tenant
                                                    </a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">No occupied units found.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'partials/modals.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/properties.js') }}"></script>
</body>
</html>
