{% include 'partials/header.html' %}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Add Transaction for {{ landlord.full_name }}</h1>
        <a href="{{ url_for('landlord_account_statement') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3 bg-primary text-white">
            <h6 class="m-0 font-weight-bold">Add Account Statement</h6>
        </div>
        <div class="card-body">
            <form method="post" action="{{ url_for('add_landlord_account', landlord_id=landlord.id) }}">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="date" class="form-label">Transaction Date <span class="text-danger">*</span></label>
                        <input type="date" class="form-control" id="date" name="date" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="type" class="form-label">Transaction Type <span class="text-danger">*</span></label>
                        <select class="form-select" id="type" name="type" required>
                            <option value="">-- Select Type --</option>
                            <option value="credit">Credit</option>
                            <option value="debit">Debit</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="narration" class="form-label">Narration / Description <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="narration" name="narration" rows="2" required></textarea>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="mode_of_payment" class="form-label">Mode of Payment <span class="text-danger">*</span></label>
                        <select class="form-select" id="mode_of_payment" name="mode_of_payment" required>
                            <option value="">-- Select Payment Method --</option>
                            <option value="Cash">Cash</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Cheque">Cheque</option>
                            <option value="POS">POS</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="amount" class="form-label">Amount (â‚¦) <span class="text-danger">*</span></label>
                        <input type="number" step="0.01" min="0" class="form-control" id="amount" name="amount" required>
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Transaction
                    </button>
                    <a href="{{ url_for('landlord_account_detail', landlord_id=landlord.id) }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

{% include 'partials/modals.html' %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('addAccountForm');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                Swal.fire({
                    title: 'Success!',
                    text: data.message,
                    icon: 'success',
                    confirmButtonText: 'View Statement'
                }).then(() => {
                    window.location.href = data.redirect;
                });
            } else {
                Swal.fire('Error', 'Something went wrong, please try again.', 'error');
            }
        })
        .catch(() => {
            Swal.fire('Error', 'Could not connect to server.', 'error');
        });
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.getElementById('flash-messages');
        if (flashMessages) {
            const messages = flashMessages.getElementsByClassName('message');
            if (messages.length > 0) {
                Swal.fire({
                    title: 'Notification',
                    text: messages[0].textContent,
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
            }
        }
    });
</script>

</body>
</html>
