<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel & Bar Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* CSS styles will go here */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f6fa;
            color: #333;
        }

        h2, h3 {
            margin-bottom: 20px;
        }

        /* Login Page */
        #loginContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #43cea2, #185a9d);
        }

        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 350px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #185a9d;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #185a9d;
            color: white;
        }

        .btn-primary:hover {
            background-color: #134b81;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none; /* Hidden by default until login */
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background-color: #2c3e50;
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }

        .brand {
            padding: 20px;
            border-bottom: 1px solid #3c5a76;
        }

        .nav-links {
            list-style: none;
            margin-top: 20px;
        }

        .nav-links li a {
            display: block;
            color: white;
            padding: 15px 20px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .nav-links li a:hover, .nav-links li a.active {
            background-color: #3c5a76;
        }

        .content-container {
            margin-left: 250px;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 24px;
            font-weight: 600;
            color: #185a9d;
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        table tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Forms */
        .form-container, .form-modal {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .form-modal {
            display: none; /* Hidden by default */
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .date-filter {
            display: none;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab-btn {
            padding: 10px 15px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn.active {
            border-bottom: 3px solid #185a9d;
            color: #185a9d;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Room Grid */
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .room-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .room-card:hover {
            transform: translateY(-5px);
        }

        .room-card.available {
            border-left: 4px solid #28a745;
        }

        .room-card.occupied {
            border-left: 4px solid #dc3545;
        }

        .room-card.maintenance {
            border-left: 4px solid #ffc107;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Receipt */
        #receiptContent {
            padding: 20px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            background-color: #f9f9f9;
            font-family: 'Courier New', Courier, monospace;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Handover Items */
        .handover-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .col-md-6 {
            flex: 0 0 calc(50% - 20px);
            padding: 0 10px;
        }

        @media screen and (max-width: 768px) {
            .col-md-6 {
                flex: 0 0 100%;
            }
            
            .sidebar {
                width: 70px;
                z-index: 100;
                transition: width 0.3s;
            }
            
            .sidebar:hover {
                width: 250px;
            }
            
            .sidebar .brand h3 {
                display: none;
            }
            
            .sidebar:hover .brand h3 {
                display: block;
            }
            
            .nav-links li a {
                padding: 15px;
                text-align: center;
                overflow: hidden;
            }
            
            .content-container {
                margin-left: 70px;
            }
        }

        /* Radio Group */
        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- HTML structure will go here -->


    <!-- Login Form -->
    <div id="loginContainer">
        <div class="login-form">
            <h2>Hotel & Bar Management System</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Admin Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="adminOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="adminStaffManagement">Staff Management</a></li>
                <li><a href="#" data-section="adminRoomManagement">Room Management</a></li>
                <li><a href="#" data-section="adminAttendance">Attendance</a></li>
                <li><a href="#" data-section="adminAccounts">Staff Accounts</a></li>
                <li><a href="#" data-section="adminBar">Bar Inventory</a></li>
                <li><a href="#" data-section="adminSettings">Settings</a></li>
                <li><a href="#" id="adminLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Admin Overview Section -->
            <div id="adminOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Total Rooms</h3>
                        <p id="adminTotalRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Available Rooms</h3>
                        <p id="adminAvailableRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Occupied Rooms</h3>
                        <p id="adminOccupiedRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Visitors</h3>
                        <p id="adminTotalVisitors">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Room Sales</h3>
                        <p id="adminRoomSales">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Bar Sales</h3>
                        <p id="adminBarSales">$0</p>
                    </div>
                </div>
            </div>

            <!-- Admin Staff Management Section -->
            <div id="adminStaffManagement" class="content-section">
                <h2>Staff Management</h2>
                <button id="addStaffBtn" class="btn btn-primary">Add New Staff</button>
                
                <div id="addStaffForm" class="form-modal">
                    <form id="staffForm">
                        <div class="form-group">
                            <label for="staffName">Full Name</label>
                            <input type="text" id="staffName" name="staffName" required>
                        </div>
                        <div class="form-group">
                            <label for="staffPhone">Phone Number</label>
                            <input type="tel" id="staffPhone" name="staffPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="staffEmail">Email</label>
                            <input type="email" id="staffEmail" name="staffEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="staffAddress">Address</label>
                            <textarea id="staffAddress" name="staffAddress" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="staffUsername">Username</label>
                            <input type="text" id="staffUsername" name="staffUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="staffPassword">Password</label>
                            <input type="password" id="staffPassword" name="staffPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="staffRole">Role</label>
                            <select id="staffRole" name="staffRole" required>
                                <option value="">Select Role</option>
                                <option value="Manager">Manager</option>
                                <option value="Receptionist">Receptionist</option>
                                <option value="Staff">Staff</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-danger" id="cancelAddStaff">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="staffTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staffTableBody">
                            <!-- Staff list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Room Management Section -->
            <div id="adminRoomManagement" class="content-section">
                <h2>Room Management</h2>
                <button id="addRoomBtn" class="btn btn-primary">Add New Room</button>
                
                <div id="addRoomForm" class="form-modal">
                    <form id="roomForm">
                        <div class="form-group">
                            <label for="roomNumber">Room Number</label>
                            <input type="text" id="roomNumber" name="roomNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="roomDescription">Description</label>
                            <textarea id="roomDescription" name="roomDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="roomPrice">Price per Night</label>
                            <input type="number" id="roomPrice" name="roomPrice" required>
                        </div>
                        <div class="form-group">
                            <label for="roomStatus">Status</label>
                            <select id="roomStatus" name="roomStatus" required>
                                <option value="Available">Available</option>
                                <option value="Occupied">Occupied</option>
                                <option value="Under Maintenance">Under Maintenance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="roomImage">Room Image (Optional)</label>
                            <input type="file" id="roomImage" name="roomImage" accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-danger" id="cancelAddRoom">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="roomTable">
                        <thead>
                            <tr>
                                <th>Room No.</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="roomTableBody">
                            <!-- Room list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Attendance Section -->
            <div id="adminAttendance" class="content-section">
                <h2>Staff Attendance</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="attendanceFilterType">View By</label>
                        <select id="attendanceFilterType">
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="custom">Custom Date Range</option>
                        </select>
                    </div>
                    <div id="dailyFilter" class="date-filter">
                        <label for="dailyDate">Select Date:</label>
                        <input type="date" id="dailyDate">
                    </div>
                    <div id="monthlyFilter" class="date-filter">
                        <label for="monthYear">Select Month:</label>
                        <input type="month" id="monthYear">
                    </div>
                    <div id="customFilter" class="date-filter">
                        <label for="startDate">Start Date:</label>
                        <input type="date" id="startDate">
                        <label for="endDate">End Date:</label>
                        <input type="date" id="endDate">
                    </div>
                    <button id="filterAttendance" class="btn btn-primary">Filter</button>
                </div>
                
                <div class="table-container">
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Time In</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- Attendance records will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Staff Accounts Section -->
            <div id="adminAccounts" class="content-section">
                <h2>Staff Accounts</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="staffSelect">Select Staff:</label>
                        <select id="staffSelect">
                            <option value="">All Staff</option>
                            <!-- Staff options will be loaded here dynamically -->
                        </select>
                    </div>
                    <button id="viewLedger" class="btn btn-primary">View Ledger</button>
                    <button id="addTransaction" class="btn btn-success">Add Transaction</button>
                </div>
                
                <div id="transactionForm" class="form-modal">
                    <form id="staffTransactionForm">
                        <div class="form-group">
                            <label for="transactionStaff">Staff Member</label>
                            <select id="transactionStaff" required>
                                <!-- Staff options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transactionType">Transaction Type</label>
                            <select id="transactionType" required>
                                <option value="Credit">Credit (Payment to Staff)</option>
                                <option value="Debit">Debit (Deduction from Staff)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transactionAmount">Amount</label>
                            <input type="number" id="transactionAmount" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="transactionDescription">Description</label>
                            <textarea id="transactionDescription" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Save Transaction</button>
                        <button type="button" class="btn btn-danger" id="cancelTransaction">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="accountLedgerTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Debit</th>
                                <th>Credit</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="accountLedgerTableBody">
                            <!-- Ledger entries will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Bar Inventory Section -->
            <div id="adminBar" class="content-section">
                <h2>Bar Inventory Management</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="inventoryFilterType">View By</label>
                        <select id="inventoryFilterType">
                            <option value="all">All Stock</option>
                            <option value="store">Store Stock</option>
                            <option value="refrigerator">Refrigerator Stock</option>
                            <option value="movements">Stock Movements</option>
                        </select>
                    </div>
                    <button id="filterInventory" class="btn btn-primary">Filter</button>
                </div>
                
                <div class="table-container">
                    <table id="barInventoryTable">
                        <thead>
                            <tr>
                                <th>Item ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Store Quantity</th>
                                <th>Refrigerator Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Value</th>
                            </tr>
                        </thead>
                        <tbody id="barInventoryTableBody">
                            <!-- Inventory data will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div id="stockMovementTable" class="table-container">
                    <h3>Stock Movement History</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Item</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Quantity</th>
                                <th>Moved By</th>
                            </tr>
                        </thead>
                        <tbody id="stockMovementTableBody">
                            <!-- Stock movement data will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Settings Section -->
            <div id="adminSettings" class="content-section">
                <h2>System Settings</h2>
                <div class="settings-container">
                    <div class="setting-card">
                        <h3>Booking Approval</h3>
                        <p>Require manager approval for room bookings:</p>
                        <label class="switch">
                            <input type="checkbox" id="requireApproval">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <div class="setting-card">
                        <h3>Change Password</h3>
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manager Dashboard -->
    <div id="managerDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Manager Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="managerOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="managerStaff">View Staff</a></li>
                <li><a href="#" data-section="managerReports">Reports & Complaints</a></li>
                <li><a href="#" data-section="managerHotel">Manage Hotel</a></li>
                <li><a href="#" data-section="managerBar">Manage Bar</a></li>
                <li><a href="#" data-section="managerSalespeople">Salesperson Management</a></li>
                <li><a href="#" data-section="managerReporting">Generate Reports</a></li>
                <li><a href="#" id="managerLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Manager Overview Section -->
            <div id="managerOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Staff Count</h3>
                        <p id="managerStaffCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Available Rooms</h3>
                        <p id="managerAvailableRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Bar Stock Items</h3>
                        <p id="managerBarStock">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Sales</h3>
                        <p id="managerTotalSales">$0</p>
                    </div>
                </div>
            </div>

            <!-- Manager View Staff Section -->
            <div id="managerStaff" class="content-section">
                <h2>Staff Management</h2>
                <div class="table-container">
                    <table id="managerStaffTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="managerStaffTableBody">
                            <!-- Staff list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Reports & Complaints Section -->
            <div id="managerReports" class="content-section">
                <h2>Staff Reports & Complaints</h2>
                <div id="reportForm" class="form-container">
                    <h3>Submit New Report</h3>
                    <form id="staffReportForm">
                        <div class="form-group">
                            <label for="reportStaff">Select Staff</label>
                            <select id="reportStaff" required>
                                <!-- Staff options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportDescription">Report Details</label>
                            <textarea id="reportDescription" rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Report Type</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="reportType" value="Penalty" required> Penalty (Debit)
                                </label>
                                <label>
                                    <input type="radio" name="reportType" value="Bonus"> Bonus (Credit)
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reportAmount">Amount</label>
                            <input type="number" id="reportAmount" required min="0">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Report</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Previous Reports</h3>
                    <table id="reportsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Reports will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Hotel Section -->
            <div id="managerHotel" class="content-section">
                <h2>Hotel Management</h2>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="roomsList">Rooms List</button>
                    <button class="tab-btn" data-tab="bookingRequests">Booking Requests</button>
                </div>
                
                <div id="roomsList" class="tab-content active">
                    <div class="table-container">
                        <table id="managerRoomTable">
                            <thead>
                                <tr>
                                    <th>Room No.</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="managerRoomTableBody">
                                <!-- Room list will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="bookingRequests" class="tab-content">
                    <div class="table-container">
                        <table id="bookingRequestsTable">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Date</th>
                                    <th>Guest Name</th>
                                    <th>Room</th>
                                    <th>Duration</th>
                                    <th>Total Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingRequestsTableBody">
                                <!-- Booking requests will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Manager Bar Section -->
            <div id="managerBar" class="content-section">
                <h2>Bar Management</h2>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="addStock">Add Stock</button>
                    <button class="tab-btn" data-tab="viewStock">View Stock</button>
                    <button class="tab-btn" data-tab="moveStock">Move to Refrigerator</button>
                    <button class="tab-btn" data-tab="salesHandover">Sales Handover</button>
                    <button class="tab-btn" data-tab="salesReturn">Sales Return</button>
                </div>
                
                <div id="addStock" class="tab-content active">
                    <h3>Add New Stock</h3>
                    <form id="addStockForm">
                        <div class="form-group">
                            <label for="stockName">Item Name</label>
                            <input type="text" id="stockName" required>
                        </div>
                        <div class="form-group">
                            <label for="stockCategory">Category</label>
                            <select id="stockCategory" required>
                                <option value="Beer">Beer</option>
                                <option value="Wine">Wine</option>
                                <option value="Spirits">Spirits</option>
                                <option value="Soft Drinks">Soft Drinks</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="stockQuantity">Quantity</label>
                            <input type="number" id="stockQuantity" required min="1">
                        </div>
                        <div class="form-group">
                            <label for="stockUnitPrice">Unit Price</label>
                            <input type="number" id="stockUnitPrice" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="stockBatchId">Batch ID (Optional)</label>
                            <input type="text" id="stockBatchId">
                        </div>
                        <button type="submit" class="btn btn-success">Add to Store</button>
                    </form>
                </div>
                
                <div id="viewStock" class="tab-content">
                    <div class="filter-controls">
                        <div class="form-group">
                            <label for="stockFilter">View</label>
                            <select id="stockFilter">
                                <option value="all">All Stock</option>
                                <option value="store">Store Only</option>
                                <option value="refrigerator">Refrigerator Only</option>
                            </select>
                        </div>
                        <button id="applyStockFilter" class="btn btn-primary">Apply</button>
                    </div>
                    
                    <div class="table-container">
                        <table id="stockTable">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Category</th>
                                    <th>Batch</th>
                                    <th>Location</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Value</th>
                                </tr>
                            </thead>
                            <tbody id="stockTableBody">
                                <!-- Stock data will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="moveStock" class="tab-content">
                    <h3>Move Stock to Refrigerator</h3>
                    <form id="moveStockForm">
                        <div class="form-group">
                            <label for="moveStockItem">Select Item</label>
                            <select id="moveStockItem" required>
                                <!-- Store items will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="moveQuantity">Quantity to Move</label>
                            <input type="number" id="moveQuantity" required min="1">
                            <small id="availableQuantity">Available: 0</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Move to Refrigerator</button>
                    </form>
                </div>
                
                <div id="salesHandover" class="tab-content">
                    <h3>Sales Handover</h3>
                    <form id="salesHandoverForm">
                        <div class="form-group">
                            <label for="handoverSalesperson">Salesperson</label>
                            <select id="handoverSalesperson" required>
                                <!-- Salesperson options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div id="handoverItems">
                            <div class="handover-item">
                                <div class="form-group">
                                    <label>Select Item</label>
                                    <select class="handover-item-select" required>
                                        <!-- Refrigerator items will be loaded here dynamically -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Quantity</label>
                                    <input type="number" class="handover-item-quantity" required min="1">
                                    <small class="available-quantity">Available: 0</small>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="addHandoverItem" class="btn btn-secondary">Add Another Item</button>
                        <button type="submit" class="btn btn-success">Complete Handover</button>
                    </form>
                </div>
                
                <div id="salesReturn" class="tab-content">
                    <h3>Sales Return</h3>
                    <form id="salesReturnForm">
                        <div class="form-group">
                            <label for="returnSalesperson">Salesperson</label>
                            <select id="returnSalesperson" required>
                                <!-- Salesperson options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div id="activeHandovers">
                            <p>No active handovers found for this salesperson.</p>
                        </div>
                        <div id="returnItems" class="hidden">
                            <h4>Items Returned</h4>
                            <div id="returnItemsList">
                                <!-- Return items form will be generated here -->
                            </div>
                            <div class="form-group">
                                <label for="salesAmount">Total Sales Amount Collected</label>
                                <input type="number" id="salesAmount" required min="0" step="0.01">
                            </div>
                            <button type="submit" class="btn btn-primary">Process Return</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Manager Salesperson Management Section -->
            <div id="managerSalespeople" class="content-section">
                <h2>Salesperson Management</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="salespersonSelect">Select Salesperson:</label>
                        <select id="salespersonSelect">
                            <option value="">All Salespeople</option>
                            <!-- Salesperson options will be loaded here dynamically -->
                        </select>
                    </div>
                    <button id="viewSalespersonLedger" class="btn btn-primary">View Ledger</button>
                </div>
                
                <div class="table-container">
                    <h3>Transactions History</h3>
                    <table id="salespersonLedgerTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Handover Value</th>
                                <th>Returns</th>
                                <th>Sales</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="salespersonLedgerTableBody">
                            <!-- Ledger entries will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Reports Generation Section -->
            <div id="managerReporting" class="content-section">
                <h2>Generate Reports</h2>
                <div class="report-controls">
                    <div class="form-group">
                        <label for="reportType">Report Type</label>
                        <select id="reportType">
                            <option value="sales">Sales Report</option>
                            <option value="staff">Staff Activity Report</option>
                            <option value="inventory">Inventory Report</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportPeriod">Period</label>
                        <select id="reportPeriod">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div id="reportDateSelectors">
                        <div id="reportDailySelector">
                            <label for="reportDate">Date</label>
                            <input type="date" id="reportDate">
                        </div>
                        <div id="reportWeeklySelector" class="hidden">
                            <label for="reportWeek">Week</label>
                            <input type="week" id="reportWeek">
                        </div>
                        <div id="reportMonthlySelector" class="hidden">
                            <label for="reportMonth">Month</label>
                            <input type="month" id="reportMonth">
                        </div>
                    </div>
                    <button id="generateReport" class="btn btn-primary">Generate Report</button>
                </div>
                
                <div id="reportResult" class="report-result">
                    <h3>Report Results</h3>
                    <div id="reportContent">
                        <!-- Report content will be loaded here dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Receptionist Dashboard -->
    <div id="receptionistDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Reception Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="receptionistOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="receptionistBookRoom">Book Room</a></li>
                <li><a href="#" data-section="receptionistAttendance">Take Attendance</a></li>
                <li><a href="#" data-section="receptionistSales">Daily Sales</a></li>
                <li><a href="#" id="receptionistLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Receptionist Overview Section -->
            <div id="receptionistOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Total Rooms</h3>
                        <p id="receptionTotalRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Occupied Rooms</h3>
                        <p id="receptionOccupiedRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Guests Checked In</h3>
                        <p id="receptionGuestsCheckedIn">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Today's Bookings</h3>
                        <p id="receptionTodayBookings">0</p>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button id="quickBookRoom" class="btn btn-primary">Book Room</button>
                    <button id="quickTakeAttendance" class="btn btn-success">Take Attendance</button>
                    <button id="quickSubmitSales" class="btn btn-info">Submit Sales</button>
                </div>
            </div>

            <!-- Receptionist Book Room Section -->
            <div id="receptionistBookRoom" class="content-section">
                <h2>Room Booking</h2>
                <div class="row">
                    <div class="col-md-6">
                        <h3>Available Rooms</h3>
                        <div class="room-grid" id="availableRoomsGrid">
                            <!-- Available rooms will be loaded here dynamically -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3>Booking Form</h3>
                        <form id="bookingForm">
                            <div class="form-group">
                                <label for="guestName">Guest Name</label>
                                <input type="text" id="guestName" required>
                            </div>
                            <div class="form-group">
                                <label for="guestContact">Contact Number</label>
                                <input type="tel" id="guestContact" required>
                            </div>
                            <div class="form-group">
                                <label for="guestAddress">Address</label>
                                <textarea id="guestAddress" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="bookingRoom">Room Number</label>
                                <input type="text" id="bookingRoom" readonly required>
                                <small>Select a room from the grid</small>
                            </div>
                            <div class="form-group">
                                <label for="bookingDuration">Duration (Days)</label>
                                <input type="number" id="bookingDuration" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="bookingPayment">Payment Amount</label>
                                <input type="number" id="bookingPayment" required>
                                <small id="roomPriceInfo">Room Price: $0 per night</small>
                            </div>
                            <button type="submit" class="btn btn-success">Complete Booking</button>
                        </form>
                    </div>
                </div>
                
                <div id="receiptModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <div id="receiptContent">
                            <!-- Receipt will be loaded here dynamically -->
                        </div>
                        <button id="printReceipt" class="btn btn-primary">Print Receipt</button>
                    </div>
                </div>
            </div>

            <!-- Receptionist Attendance Section -->
            <div id="receptionistAttendance" class="content-section">
                <h2>Take Staff Attendance</h2>
                <div class="date-display">
                    <h3 id="currentDate">Current Date: </h3>
                </div>
                
                <div class="attendance-form">
                    <form id="attendanceForm">
                        <div class="form-group">
                            <label for="staffId">Staff ID</label>
                            <input type="text" id="staffId" required>
                        </div>
                        <button type="submit" class="btn btn-success">Mark Present</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Today's Attendance</h3>
                    <table id="todayAttendanceTable">
                        <thead>
                            <tr>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Time In</th>
                            </tr>
                        </thead>
                        <tbody id="todayAttendanceTableBody">
                            <!-- Today's attendance will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Receptionist Daily Sales Section -->
            <div id="receptionistSales" class="content-section">
                <h2>Submit Daily Sales</h2>
                <div class="sales-summary">
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h3>Expected Collection</h3>
                            <p id="expectedCollection">$0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Submitted Today</h3>
                            <p id="submittedToday">$0</p>
                        </div>
                    </div>
                </div>
                
                <div class="sales-form">
                    <form id="salesSubmissionForm">
                        <div class="form-group">
                            <label for="submissionAmount">Amount Collected</label>
                            <input type="number" id="submissionAmount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="submissionNotes">Notes (Optional)</label>
                            <textarea id="submissionNotes"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Sales</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Today's Bookings</h3>
                    <table id="todayBookingsTable">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Guest</th>
                                <th>Room</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="todayBookingsTableBody">
                            <!-- Today's bookings will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript code will go here
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel & Bar Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f6fa;
            color: #333;
        }

        h2, h3 {
            margin-bottom: 20px;
        }

        /* Login Page */
        #loginContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #43cea2, #185a9d);
        }

        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 350px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #185a9d;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #185a9d;
            color: white;
        }

        .btn-primary:hover {
            background-color: #134b81;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none; /* Hidden by default until login */
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background-color: #2c3e50;
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }

        .brand {
            padding: 20px;
            border-bottom: 1px solid #3c5a76;
        }

        .nav-links {
            list-style: none;
            margin-top: 20px;
        }

        .nav-links li a {
            display: block;
            color: white;
            padding: 15px 20px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .nav-links li a:hover, .nav-links li a.active {
            background-color: #3c5a76;
        }

        .content-container {
            margin-left: 250px;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 24px;
            font-weight: 600;
            color: #185a9d;
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        table tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Forms */
        .form-container, .form-modal {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .form-modal {
            display: none; /* Hidden by default */
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .date-filter {
            display: none;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab-btn {
            padding: 10px 15px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn.active {
            border-bottom: 3px solid #185a9d;
            color: #185a9d;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Room Grid */
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .room-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .room-card:hover {
            transform: translateY(-5px);
        }

        .room-card.available {
            border-left: 4px solid #28a745;
        }

        .room-card.occupied {
            border-left: 4px solid #dc3545;
        }

        .room-card.maintenance {
            border-left: 4px solid #ffc107;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Receipt */
        #receiptContent {
            padding: 20px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            background-color: #f9f9f9;
            font-family: 'Courier New', Courier, monospace;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Handover Items */
        .handover-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .col-md-6 {
            flex: 0 0 calc(50% - 20px);
            padding: 0 10px;
        }

        @media screen and (max-width: 768px) {
            .col-md-6 {
                flex: 0 0 100%;
            }
            
            .sidebar {
                width: 70px;
                z-index: 100;
                transition: width 0.3s;
            }
            
            .sidebar:hover {
                width: 250px;
            }
            
            .sidebar .brand h3 {
                display: none;
            }
            
            .sidebar:hover .brand h3 {
                display: block;
            }
            
            .nav-links li a {
                padding: 15px;
                text-align: center;
                overflow: hidden;
            }
            
            .content-container {
                margin-left: 70px;
            }
        }

        /* Radio Group */
        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Additional Responsive Styling */
        @media screen and (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .table-container {
                overflow-x: auto;
                max-width: 100%;
            }
            
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-controls .form-group {
                margin-bottom: 10px;
            }
        }

        /* Status Indicators */
        .status-active, .status-available {
            color: #28a745;
            font-weight: 500;
            padding: 3px 8px;
            background-color: rgba(40, 167, 69, 0.1);
            border-radius: 4px;
        }

        .status-inactive, .status-occupied {
            color: #dc3545;
            font-weight: 500;
            padding: 3px 8px;
            background-color: rgba(220, 53, 69, 0.1);
            border-radius: 4px;
        }

        .status-maintenance {
            color: #ffc107;
            font-weight: 500;
            padding: 3px 8px;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 4px;
        }

        /* Form Modal Styling */
        .form-modal {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s;
        }

        /* Button Styling */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 38px;
            padding: 0 15px;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }

        .btn-sm {
            height: 32px;
            padding: 0 10px;
            font-size: 12px;
        }

        /* Report Styling */
        .report-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .summary-item h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #666;
        }

        .summary-item p {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .report-details {
            margin-top: 20px;
        }

        .report-details h3 {
            margin: 20px 0 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        /* Receipt Styling */
        .receipt {
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.5;
        }

        .receipt h2 {
            text-align: center;
            margin-bottom: 10px;
        }

        .receipt hr {
            border: none;
            border-top: 1px dashed #ccc;
            margin: 10px 0;
        }

        .no-smoking {
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        /* Room Card Selected State */
        .room-card.selected {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #185a9d;
            border-left-width: 4px;
        }

        /* Text Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-danger {
            color: #dc3545;
        }

        .text-success {
            color: #28a745;
        }

        /* Handover Item Styling */
        .handover-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .available-quantity {
            color: #6c757d;
            font-style: italic;
        }

        .remove-item {
            margin-left: 10px;
            align-self: flex-end;
        }

        /* Settings Card */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer">
        <div class="login-form">
            <h2>Hotel & Bar Management System</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Admin Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="adminOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="adminStaffManagement">Staff Management</a></li>
                <li><a href="#" data-section="adminRoomManagement">Room Management</a></li>
                <li><a href="#" data-section="adminAttendance">Attendance</a></li>
                <li><a href="#" data-section="adminAccounts">Staff Accounts</a></li>
                <li><a href="#" data-section="adminBar">Bar Inventory</a></li>
                <li><a href="#" data-section="adminSettings">Settings</a></li>
                <li><a href="#" id="adminLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Admin Overview Section -->
            <div id="adminOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Total Rooms</h3>
                        <p id="adminTotalRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Available Rooms</h3>
                        <p id="adminAvailableRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Occupied Rooms</h3>
                        <p id="adminOccupiedRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Visitors</h3>
                        <p id="adminTotalVisitors">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Room Sales</h3>
                        <p id="adminRoomSales">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Bar Sales</h3>
                        <p id="adminBarSales">$0</p>
                    </div>
                </div>
            </div>

            <!-- Admin Staff Management Section -->
            <div id="adminStaffManagement" class="content-section">
                <h2>Staff Management</h2>
                <button id="addStaffBtn" class="btn btn-primary">Add New Staff</button>
                
                <div id="addStaffForm" class="form-modal">
                    <form id="staffForm">
                        <div class="form-group">
                            <label for="staffName">Full Name</label>
                            <input type="text" id="staffName" name="staffName" required>
                        </div>
                        <div class="form-group">
                            <label for="staffPhone">Phone Number</label>
                            <input type="tel" id="staffPhone" name="staffPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="staffEmail">Email</label>
                            <input type="email" id="staffEmail" name="staffEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="staffAddress">Address</label>
                            <textarea id="staffAddress" name="staffAddress" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="staffUsername">Username</label>
                            <input type="text" id="staffUsername" name="staffUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="staffPassword">Password</label>
                            <input type="password" id="staffPassword" name="staffPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="staffRole">Role</label>
                            <select id="staffRole" name="staffRole" required>
                                <option value="">Select Role</option>
                                <option value="Manager">Manager</option>
                                <option value="Receptionist">Receptionist</option>
                                <option value="Staff">Staff</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-danger" id="cancelAddStaff">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="staffTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staffTableBody">
                            <!-- Staff list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Room Management Section -->
            <div id="adminRoomManagement" class="content-section">
                <h2>Room Management</h2>
                <button id="addRoomBtn" class="btn btn-primary">Add New Room</button>
                
                <div id="addRoomForm" class="form-modal">
                    <form id="roomForm">
                        <div class="form-group">
                            <label for="roomNumber">Room Number</label>
                            <input type="text" id="roomNumber" name="roomNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="roomDescription">Description</label>
                            <textarea id="roomDescription" name="roomDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="roomPrice">Price per Night</label>
                            <input type="number" id="roomPrice" name="roomPrice" required>
                        </div>
                        <div class="form-group">
                            <label for="roomStatus">Status</label>
                            <select id="roomStatus" name="roomStatus" required>
                                <option value="Available">Available</option>
                                <option value="Occupied">Occupied</option>
                                <option value="Under Maintenance">Under Maintenance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="roomImage">Room Image (Optional)</label>
                            <input type="file" id="roomImage" name="roomImage" accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-danger" id="cancelAddRoom">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="roomTable">
                        <thead>
                            <tr>
                                <th>Room No.</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="roomTableBody">
                            <!-- Room list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Attendance Section -->
            <div id="adminAttendance" class="content-section">
                <h2>Staff Attendance</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="attendanceFilterType">View By</label>
                        <select id="attendanceFilterType">
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="custom">Custom Date Range</option>
                        </select>
                    </div>
                    <div id="dailyFilter" class="date-filter">
                        <label for="dailyDate">Select Date:</label>
                        <input type="date" id="dailyDate">
                    </div>
                    <div id="monthlyFilter" class="date-filter">
                        <label for="monthYear">Select Month:</label>
                        <input type="month" id="monthYear">
                    </div>
                    <div id="customFilter" class="date-filter">
                        <label for="startDate">Start Date:</label>
                        <input type="date" id="startDate">
                        <label for="endDate">End Date:</label>
                        <input type="date" id="endDate">
                    </div>
                    <button id="filterAttendance" class="btn btn-primary">Filter</button>
                </div>
                
                <div class="table-container">
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Time In</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- Attendance records will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Staff Accounts Section -->
            <div id="adminAccounts" class="content-section">
                <h2>Staff Accounts</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="staffSelect">Select Staff:</label>
                        <select id="staffSelect">
                            <option value="">All Staff</option>
                            <!-- Staff options will be loaded here dynamically -->
                        </select>
                    </div>
                    <button id="viewLedger" class="btn btn-primary">View Ledger</button>
                    <button id="addTransaction" class="btn btn-success">Add Transaction</button>
                </div>
                
                <div id="transactionForm" class="form-modal">
                    <form id="staffTransactionForm">
                        <div class="form-group">
                            <label for="transactionStaff">Staff Member</label>
                            <select id="transactionStaff" required>
                                <!-- Staff options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transactionType">Transaction Type</label>
                            <select id="transactionType" required>
                                <option value="Credit">Credit (Payment to Staff)</option>
                                <option value="Debit">Debit (Deduction from Staff)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transactionAmount">Amount</label>
                            <input type="number" id="transactionAmount" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="transactionDescription">Description</label>
                            <textarea id="transactionDescription" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Save Transaction</button>
                        <button type="button" class="btn btn-danger" id="cancelTransaction">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <table id="accountLedgerTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Debit</th>
                                <th>Credit</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="accountLedgerTableBody">
                            <!-- Ledger entries will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Bar Inventory Section -->
            <div id="adminBar" class="content-section">
                <h2>Bar Inventory Management</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="inventoryFilterType">View By</label>
                        <select id="inventoryFilterType">
                            <option value="all">All Stock</option>
                            <option value="store">Store Stock</option>
                            <option value="refrigerator">Refrigerator Stock</option>
                            <option value="movements">Stock Movements</option>
                        </select>
                    </div>
                    <button id="filterInventory" class="btn btn-primary">Filter</button>
                </div>
                
                <div class="table-container">
                    <table id="barInventoryTable">
                        <thead>
                            <tr>
                                <th>Item ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Store Quantity</th>
                                <th>Refrigerator Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Value</th>
                            </tr>
                        </thead>
                        <tbody id="barInventoryTableBody">
                            <!-- Inventory data will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div id="stockMovementTable" class="table-container">
                    <h3>Stock Movement History</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Item</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Quantity</th>
                                <th>Moved By</th>
                            </tr>
                        </thead>
                        <tbody id="stockMovementTableBody">
                            <!-- Stock movement data will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Settings Section -->
            <div id="adminSettings" class="content-section">
                <h2>System Settings</h2>
                <div class="settings-container">
                    <div class="setting-card">
                        <h3>Booking Approval</h3>
                        <p>Require manager approval for room bookings:</p>
                        <label class="switch">
                            <input type="checkbox" id="requireApproval">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <div class="setting-card">
                        <h3>Change Password</h3>
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manager Dashboard -->
    <div id="managerDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Manager Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="managerOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="managerStaff">View Staff</a></li>
                <li><a href="#" data-section="managerReports">Reports & Complaints</a></li>
                <li><a href="#" data-section="managerHotel">Manage Hotel</a></li>
                <li><a href="#" data-section="managerBar">Manage Bar</a></li>
                <li><a href="#" data-section="managerSalespeople">Salesperson Management</a></li>
                <li><a href="#" data-section="managerReporting">Generate Reports</a></li>
                <li><a href="#" id="managerLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Manager Overview Section -->
            <div id="managerOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Staff Count</h3>
                        <p id="managerStaffCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Available Rooms</h3>
                        <p id="managerAvailableRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Bar Stock Items</h3>
                        <p id="managerBarStock">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Sales</h3>
                        <p id="managerTotalSales">$0</p>
                    </div>
                </div>
            </div>

            <!-- Manager View Staff Section -->
            <div id="managerStaff" class="content-section">
                <h2>Staff Management</h2>
                <div class="table-container">
                    <table id="managerStaffTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="managerStaffTableBody">
                            <!-- Staff list will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Reports & Complaints Section -->
            <div id="managerReports" class="content-section">
                <h2>Staff Reports & Complaints</h2>
                <div id="reportForm" class="form-container">
                    <h3>Submit New Report</h3>
                    <form id="staffReportForm">
                        <div class="form-group">
                            <label for="reportStaff">Select Staff</label>
                            <select id="reportStaff" required>
                                <!-- Staff options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportDescription">Report Details</label>
                            <textarea id="reportDescription" rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Report Type</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="reportType" value="Penalty" required> Penalty (Debit)
                                </label>
                                <label>
                                    <input type="radio" name="reportType" value="Bonus"> Bonus (Credit)
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="reportAmount">Amount</label>
                            <input type="number" id="reportAmount" required min="0">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Report</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Previous Reports</h3>
                    <table id="reportsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Staff</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Reports will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Hotel Section -->
            <div id="managerHotel" class="content-section">
                <h2>Hotel Management</h2>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="roomsList">Rooms List</button>
                    <button class="tab-btn" data-tab="bookingRequests">Booking Requests</button>
                </div>
                
                <div id="roomsList" class="tab-content active">
                    <div class="table-container">
                        <table id="managerRoomTable">
                            <thead>
                                <tr>
                                    <th>Room No.</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="managerRoomTableBody">
                                <!-- Room list will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="bookingRequests" class="tab-content">
                    <div class="table-container">
                        <table id="bookingRequestsTable">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Date</th>
                                    <th>Guest Name</th>
                                    <th>Room</th>
                                    <th>Duration</th>
                                    <th>Total Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingRequestsTableBody">
                                <!-- Booking requests will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Manager Bar Section -->
            <div id="managerBar" class="content-section">
                <h2>Bar Management</h2>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="addStock">Add Stock</button>
                    <button class="tab-btn" data-tab="viewStock">View Stock</button>
                    <button class="tab-btn" data-tab="moveStock">Move to Refrigerator</button>
                    <button class="tab-btn" data-tab="salesHandover">Sales Handover</button>
                    <button class="tab-btn" data-tab="salesReturn">Sales Return</button>
                </div>
                
                <div id="addStock" class="tab-content active">
                    <h3>Add New Stock</h3>
                    <form id="addStockForm">
                        <div class="form-group">
                            <label for="stockName">Item Name</label>
                            <input type="text" id="stockName" required>
                        </div>
                        <div class="form-group">
                            <label for="stockCategory">Category</label>
                            <select id="stockCategory" required>
                                <option value="Beer">Beer</option>
                                <option value="Wine">Wine</option>
                                <option value="Spirits">Spirits</option>
                                <option value="Soft Drinks">Soft Drinks</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="stockQuantity">Quantity</label>
                            <input type="number" id="stockQuantity" required min="1">
                        </div>
                        <div class="form-group">
                            <label for="stockUnitPrice">Unit Price</label>
                            <input type="number" id="stockUnitPrice" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="stockBatchId">Batch ID (Optional)</label>
                            <input type="text" id="stockBatchId">
                        </div>
                        <button type="submit" class="btn btn-success">Add to Store</button>
                    </form>
                </div>
                
                <div id="viewStock" class="tab-content">
                    <div class="filter-controls">
                        <div class="form-group">
                            <label for="stockFilter">View</label>
                            <select id="stockFilter">
                                <option value="all">All Stock</option>
                                <option value="store">Store Only</option>
                                <option value="refrigerator">Refrigerator Only</option>
                            </select>
                        </div>
                        <button id="applyStockFilter" class="btn btn-primary">Apply</button>
                    </div>
                    
                    <div class="table-container">
                        <table id="stockTable">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Category</th>
                                    <th>Batch</th>
                                    <th>Location</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Value</th>
                                </tr>
                            </thead>
                            <tbody id="stockTableBody">
                                <!-- Stock data will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="moveStock" class="tab-content">
                    <h3>Move Stock to Refrigerator</h3>
                    <form id="moveStockForm">
                        <div class="form-group">
                            <label for="moveStockItem">Select Item</label>
                            <select id="moveStockItem" required>
                                <!-- Store items will be loaded here dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="moveQuantity">Quantity to Move</label>
                            <input type="number" id="moveQuantity" required min="1">
                            <small id="availableQuantity">Available: 0</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Move to Refrigerator</button>
                    </form>
                </div>
                
                <div id="salesHandover" class="tab-content">
                    <h3>Sales Handover</h3>
                    <form id="salesHandoverForm">
                        <div class="form-group">
                            <label for="handoverSalesperson">Salesperson</label>
                            <select id="handoverSalesperson" required>
                                <!-- Salesperson options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div id="handoverItems">
                            <div class="handover-item">
                                <div class="form-group">
                                    <label>Select Item</label>
                                    <select class="handover-item-select" required>
                                        <!-- Refrigerator items will be loaded here dynamically -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Quantity</label>
                                    <input type="number" class="handover-item-quantity" required min="1">
                                    <small class="available-quantity">Available: 0</small>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="addHandoverItem" class="btn btn-secondary">Add Another Item</button>
                        <button type="submit" class="btn btn-success">Complete Handover</button>
                    </form>
                </div>
                
                <div id="salesReturn" class="tab-content">
                    <h3>Sales Return</h3>
                    <form id="salesReturnForm">
                        <div class="form-group">
                            <label for="returnSalesperson">Salesperson</label>
                            <select id="returnSalesperson" required>
                                <!-- Salesperson options will be loaded here dynamically -->
                            </select>
                        </div>
                        <div id="activeHandovers">
                            <p>No active handovers found for this salesperson.</p>
                        </div>
                        <div id="returnItems" class="hidden">
                            <h4>Items Returned</h4>
                            <div id="returnItemsList">
                                <!-- Return items form will be generated here -->
                            </div>
                            <div class="form-group">
                                <label for="salesAmount">Total Sales Amount Collected</label>
                                <input type="number" id="salesAmount" required min="0" step="0.01">
                            </div>
                            <button type="submit" class="btn btn-primary">Process Return</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Manager Salesperson Management Section -->
            <div id="managerSalespeople" class="content-section">
                <h2>Salesperson Management</h2>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="salespersonSelect">Select Salesperson:</label>
                        <select id="salespersonSelect">
                            <option value="">All Salespeople</option>
                            <!-- Salesperson options will be loaded here dynamically -->
                        </select>
                    </div>
                    <button id="viewSalespersonLedger" class="btn btn-primary">View Ledger</button>
                </div>
                
                <div class="table-container">
                    <h3>Transactions History</h3>
                    <table id="salespersonLedgerTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Handover Value</th>
                                <th>Returns</th>
                                <th>Sales</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="salespersonLedgerTableBody">
                            <!-- Ledger entries will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manager Reports Generation Section -->
            <div id="managerReporting" class="content-section">
                <h2>Generate Reports</h2>
                <div class="report-controls">
                    <div class="form-group">
                        <label for="reportType">Report Type</label>
                        <select id="reportType">
                            <option value="sales">Sales Report</option>
                            <option value="staff">Staff Activity Report</option>
                            <option value="inventory">Inventory Report</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportPeriod">Period</label>
                        <select id="reportPeriod">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div id="reportDateSelectors">
                        <div id="reportDailySelector">
                            <label for="reportDate">Date</label>
                            <input type="date" id="reportDate">
                        </div>
                        <div id="reportWeeklySelector" class="hidden">
                            <label for="reportWeek">Week</label>
                            <input type="week" id="reportWeek">
                        </div>
                        <div id="reportMonthlySelector" class="hidden">
                            <label for="reportMonth">Month</label>
                            <input type="month" id="reportMonth">
                        </div>
                    </div>
                    <button id="generateReport" class="btn btn-primary">Generate Report</button>
                </div>
                
                <div id="reportResult" class="report-result">
                    <h3>Report Results</h3>
                    <div id="reportContent">
                        <!-- Report content will be loaded here dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Receptionist Dashboard -->
    <div id="receptionistDashboard" class="dashboard">
        <div class="sidebar">
            <div class="brand">
                <h3>Reception Panel</h3>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="receptionistOverview" class="active">Overview</a></li>
                <li><a href="#" data-section="receptionistBookRoom">Book Room</a></li>
                <li><a href="#" data-section="receptionistAttendance">Take Attendance</a></li>
                <li><a href="#" data-section="receptionistSales">Daily Sales</a></li>
                <li><a href="#" id="receptionistLogout">Logout</a></li>
            </ul>
        </div>
        <div class="content-container">
            <!-- Receptionist Overview Section -->
            <div id="receptionistOverview" class="content-section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Total Rooms</h3>
                        <p id="receptionTotalRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Occupied Rooms</h3>
                        <p id="receptionOccupiedRooms">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Guests Checked In</h3>
                        <p id="receptionGuestsCheckedIn">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Today's Bookings</h3>
                        <p id="receptionTodayBookings">0</p>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button id="quickBookRoom" class="btn btn-primary">Book Room</button>
                    <button id="quickTakeAttendance" class="btn btn-success">Take Attendance</button>
                    <button id="quickSubmitSales" class="btn btn-info">Submit Sales</button>
                </div>
            </div>

            <!-- Receptionist Book Room Section -->
            <div id="receptionistBookRoom" class="content-section">
                <h2>Room Booking</h2>
                <div class="row">
                    <div class="col-md-6">
                        <h3>Available Rooms</h3>
                        <div class="room-grid" id="availableRoomsGrid">
                            <!-- Available rooms will be loaded here dynamically -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3>Booking Form</h3>
                        <form id="bookingForm">
                            <div class="form-group">
                                <label for="guestName">Guest Name</label>
                                <input type="text" id="guestName" required>
                            </div>
                            <div class="form-group">
                                <label for="guestContact">Contact Number</label>
                                <input type="tel" id="guestContact" required>
                            </div>
                            <div class="form-group">
                                <label for="guestAddress">Address</label>
                                <textarea id="guestAddress" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="bookingRoom">Room Number</label>
                                <input type="text" id="bookingRoom" readonly required>
                                <small>Select a room from the grid</small>
                            </div>
                            <div class="form-group">
                                <label for="bookingDuration">Duration (Days)</label>
                                <input type="number" id="bookingDuration" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="bookingPayment">Payment Amount</label>
                                <input type="number" id="bookingPayment" required>
                                <small id="roomPriceInfo">Room Price: $0 per night</small>
                            </div>
                            <button type="submit" class="btn btn-success">Complete Booking</button>
                        </form>
                    </div>
                </div>
                
                <div id="receiptModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <div id="receiptContent">
                            <!-- Receipt will be loaded here dynamically -->
                        </div>
                        <button id="printReceipt" class="btn btn-primary">Print Receipt</button>
                    </div>
                </div>
            </div>

            <!-- Receptionist Attendance Section -->
            <div id="receptionistAttendance" class="content-section">
                <h2>Take Staff Attendance</h2>
                <div class="date-display">
                    <h3 id="currentDate">Current Date: </h3>
                </div>
                
                <div class="attendance-form">
                    <form id="attendanceForm">
                        <div class="form-group">
                            <label for="staffId">Staff ID</label>
                            <input type="text" id="staffId" required>
                        </div>
                        <button type="submit" class="btn btn-success">Mark Present</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Today's Attendance</h3>
                    <table id="todayAttendanceTable">
                        <thead>
                            <tr>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Time In</th>
                            </tr>
                        </thead>
                        <tbody id="todayAttendanceTableBody">
                            <!-- Today's attendance will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Receptionist Daily Sales Section -->
            <div id="receptionistSales" class="content-section">
                <h2>Submit Daily Sales</h2>
                <div class="sales-summary">
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h3>Expected Collection</h3>
                            <p id="expectedCollection">$0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Submitted Today</h3>
                            <p id="submittedToday">$0</p>
                        </div>
                    </div>
                </div>
                
                <div class="sales-form">
                    <form id="salesSubmissionForm">
                        <div class="form-group">
                            <label for="submissionAmount">Amount Collected</label>
                            <input type="number" id="submissionAmount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="submissionNotes">Notes (Optional)</label>
                            <textarea id="submissionNotes"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Sales</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <h3>Today's Bookings</h3>
                    <table id="todayBookingsTable">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Guest</th>
                                <th>Room</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="todayBookingsTableBody">
                            <!-- Today's bookings will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize SweetAlert if it's not available
        if (typeof Swal === 'undefined') {
            // Fallback to basic alerts if SweetAlert is not available
            window.Swal = {
                fire: function(options) {
                    if (options.icon === 'error') {
                        alert(options.title + '\n' + options.text);
                    } else if (options.icon === 'success') {
                        alert(options.title + '\n' + options.text);
                    } else if (options.icon === 'warning' && options.showCancelButton) {
                        return { then: function(callback) {
                            if (confirm(options.title + '\n' + options.text)) {
                                callback({ isConfirmed: true });
                            } else {
                                callback({ isConfirmed: false });
                            }
                        }};
                    } else {
                        alert(options.title + '\n' + options.text);
                    }
                    return { then: function(callback) { callback({ isConfirmed: true }); } };
                }
            };
        }

        // Global variables
        let currentUser = null;
        let db = null;
        let requireManagerApproval = false;

        // IndexedDB initialization
        function initializeDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HotelManagementSystem', 1);
                
                request.onerror = (event) => {
                    reject('Error opening database: ' + event.target.errorCode);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Create Users store
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'username' });
                        usersStore.createIndex('role', 'role', { unique: false });
                        usersStore.createIndex('active', 'active', { unique: false });
                        
                        // Add default users
                        usersStore.transaction.oncomplete = (event) => {
                            const usersObjectStore = db.transaction('users', 'readwrite').objectStore('users');
                            
                            // Default users
                            const defaultUsers = [
                                { username: 'admin1', password: 'admin123', role: 'Admin', name: 'Admin User', active: true },
                                { username: 'manager1', password: 'manager123', role: 'Manager', name: 'Manager User', active: true },
                                { username: 'reception1', password: 'reception123', role: 'Receptionist', name: 'Reception User', active: true }
                            ];
                            
                            defaultUsers.forEach(user => {
                                usersObjectStore.add(user);
                            });
                        };
                    }
                    
                    // Create Staff store
                    if (!db.objectStoreNames.contains('staff')) {
                        const staffStore = db.createObjectStore('staff', { keyPath: 'id', autoIncrement: true });
                        staffStore.createIndex('username', 'username', { unique: true });
                        staffStore.createIndex('role', 'role', { unique: false });
                        staffStore.createIndex('active', 'active', { unique: false });
                        
                        // Add default staff entries for existing users
                        staffStore.transaction.oncomplete = (event) => {
                            const staffObjectStore = db.transaction('staff', 'readwrite').objectStore('staff');
                            
                            // Default staff entries
                            const defaultStaff = [
                                { 
                                    username: 'admin1', 
                                    name: 'Admin User', 
                                    role: 'Admin', 
                                    phone: '123-456-7890', 
                                    email: 'admin@hotel.com', 
                                    address: 'Hotel Address', 
                                    active: true 
                                },
                                { 
                                    username: 'manager1', 
                                    name: 'Manager User', 
                                    role: 'Manager', 
                                    phone: '123-456-7891', 
                                    email: 'manager@hotel.com', 
                                    address: 'Hotel Address', 
                                    active: true 
                                },
                                { 
                                    username: 'reception1', 
                                    name: 'Reception User', 
                                    role: 'Receptionist', 
                                    phone: '123-456-7892', 
                                    email: 'reception@hotel.com', 
                                    address: 'Hotel Address', 
                                    active: true 
                                }
                            ];
                            
                            defaultStaff.forEach(staff => {
                                staffObjectStore.add(staff);
                            });
                        };
                    }
                    
                    // Create Rooms store
                    if (!db.objectStoreNames.contains('rooms')) {
                        const roomsStore = db.createObjectStore('rooms', { keyPath: 'roomNumber' });
                        roomsStore.createIndex('status', 'status', { unique: false });
                        
                        // Add some default rooms
                        roomsStore.transaction.oncomplete = (event) => {
                            const roomsObjectStore = db.transaction('rooms', 'readwrite').objectStore('rooms');
                            
                            // Default rooms
                            const defaultRooms = [
                                { roomNumber: '101', description: 'Standard Single Room', price: 100, status: 'Available', image: null },
                                { roomNumber: '102', description: 'Standard Double Room', price: 150, status: 'Available', image: null },
                                { roomNumber: '103', description: 'Deluxe Single Room', price: 200, status: 'Available', image: null },
                                { roomNumber: '104', description: 'Deluxe Double Room', price: 250, status: 'Available', image: null },
                                { roomNumber: '105', description: 'Suite', price: 350, status: 'Available', image: null }
                            ];
                            
                            defaultRooms.forEach(room => {
                                roomsObjectStore.add(room);
                            });
                        };
                    }
                    
                    // Create Bookings store
                    if (!db.objectStoreNames.contains('bookings')) {
                        const bookingsStore = db.createObjectStore('bookings', { keyPath: 'id', autoIncrement: true });
                        bookingsStore.createIndex('roomNumber', 'roomNumber', { unique: false });
                        bookingsStore.createIndex('status', 'status', { unique: false });
                        bookingsStore.createIndex('checkInDate', 'checkInDate', { unique: false });
                    }
                    
                    // Create Attendance store
                    if (!db.objectStoreNames.contains('attendance')) {
                        const attendanceStore = db.createObjectStore('attendance', { keyPath: 'id', autoIncrement: true });
                        attendanceStore.createIndex('staffId', 'staffId', { unique: false });
                        attendanceStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Create Transactions store
                    if (!db.objectStoreNames.contains('transactions')) {
                        const transactionsStore = db.createObjectStore('transactions', { keyPath: 'id', autoIncrement: true });
                        transactionsStore.createIndex('staffId', 'staffId', { unique: false });
                        transactionsStore.createIndex('date', 'date', { unique: false });
                        transactionsStore.createIndex('type', 'type', { unique: false });
                    }
                    
                    // Create Inventory store
                    if (!db.objectStoreNames.contains('inventory')) {
                        const inventoryStore = db.createObjectStore('inventory', { keyPath: 'id', autoIncrement: true });
                        inventoryStore.createIndex('name', 'name', { unique: false });
                        inventoryStore.createIndex('location', 'location', { unique: false });
                        inventoryStore.createIndex('batchId', 'batchId', { unique: false });
                    }
                    
                    // Create Stock Movements store
                    if (!db.objectStoreNames.contains('stockMovements')) {
                        const stockMovementsStore = db.createObjectStore('stockMovements', { keyPath: 'id', autoIncrement: true });
                        stockMovementsStore.createIndex('inventoryId', 'inventoryId', { unique: false });
                        stockMovementsStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Create Sales Handover store
                    if (!db.objectStoreNames.contains('salesHandovers')) {
                        const salesHandoversStore = db.createObjectStore('salesHandovers', { keyPath: 'id', autoIncrement: true });
                        salesHandoversStore.createIndex('salespersonId', 'salespersonId', { unique: false });
                        salesHandoversStore.createIndex('date', 'date', { unique: false });
                        salesHandoversStore.createIndex('status', 'status', { unique: false });
                    }
                    
                    // Create Reports store
                    if (!db.objectStoreNames.contains('reports')) {
                        const reportsStore = db.createObjectStore('reports', { keyPath: 'id', autoIncrement: true });
                        reportsStore.createIndex('staffId', 'staffId', { unique: false });
                        reportsStore.createIndex('date', 'date', { unique: false });
                        reportsStore.createIndex('type', 'type', { unique: false });
                    }
                    
                    // Create Settings store
                    if (!db.objectStoreNames.contains('settings')) {
                        const settingsStore = db.createObjectStore('settings', { keyPath: 'name' });
                        
                        // Add default settings
                        settingsStore.transaction.oncomplete = (event) => {
                            const settingsObjectStore = db.transaction('settings', 'readwrite').objectStore('settings');
                            settingsObjectStore.add({ name: 'requireManagerApproval', value: false });
                        };
                    }
                    
                    // Create Sales Submissions store
                    if (!db.objectStoreNames.contains('salesSubmissions')) {
                        db.createObjectStore('salesSubmissions', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // Login functions
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                Swal.fire({
                    icon: 'error',
                    title: 'Login Failed',
                    text: 'Please enter both username and password.'
                });
                return;
            }
            
            const transaction = db.transaction(['users'], 'readonly');
            const usersStore = transaction.objectStore('users');
            const request = usersStore.get(username);
            
            request.onsuccess = (event) => {
                const user = event.target.result;
                
                if (user && user.password === password) {
                    // Check if user is active
                    if (!user.active) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Account Deactivated',
                            text: 'Your account has been deactivated. Please contact Admin.'
                        });
                        return;
                    }
                    
                    // Login successful
                    currentUser = user;
                    
                    // Hide login container and show the appropriate dashboard
                    document.getElementById('loginContainer').style.display = 'none';
                    
                    // Get settings
                    getSettings().then(() => {
                        // Show appropriate dashboard based on user role
                        if (user.role === 'Admin') {
                            document.getElementById('adminDashboard').style.display = 'flex';
                            initAdminDashboard();
                        } else if (user.role === 'Manager') {
                            document.getElementById('managerDashboard').style.display = 'flex';
                            initManagerDashboard();
                        } else if (user.role === 'Receptionist') {
                            document.getElementById('receptionistDashboard').style.display = 'flex';
                            initReceptionistDashboard();
                        }
                        
                        // Clear login form
                        document.getElementById('loginForm').reset();
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Login Successful',
                            text: `Welcome, ${user.name}!`
                        });
                    });
                } else {
                    // Login failed
                    Swal.fire({
                        icon: 'error',
                        title: 'Login Failed',
                        text: 'Invalid username or password.'
                    });
                }
            };
            
            request.onerror = (event) => {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred while logging in.'
                });
            };
        }

        // Get settings from database
        function getSettings() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['settings'], 'readonly');
                const settingsStore = transaction.objectStore('settings');
                const request = settingsStore.get('requireManagerApproval');
                
                request.onsuccess = (event) => {
                    const setting = event.target.result;
                    if (setting) {
                        requireManagerApproval = setting.value;
                    }
                    resolve();
                };
                
                request.onerror = (event) => {
                    console.error('Error getting settings:', event.target.error);
                    reject(event.target.error);
                };
            });
        }

        // Logout function
        function handleLogout(role) {
            Swal.fire({
                title: 'Logout',
                text: 'Are you sure you want to logout?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Hide all dashboards
                    document.getElementById('adminDashboard').style.display = 'none';
                    document.getElementById('managerDashboard').style.display = 'none';
                    document.getElementById('receptionistDashboard').style.display = 'none';
                    
                    // Show login container
                    document.getElementById('loginContainer').style.display = 'flex';
                    
                    // Reset current user
                    currentUser = null;
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Logged Out',
                        text: 'You have been successfully logged out.'
                    });
                }
            });
        }

        // Initialize Admin Dashboard
        function initAdminDashboard() {
            // Load stats for overview
            updateAdminOverviewStats();
            
            // Load staff table
            loadStaffTable();
            
            // Load rooms table
            loadRoomsTable();
            
            // Load attendance table
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            loadAttendanceTable('daily', today);
            
            // Load staff select for accounts
            loadStaffSelectOptions();
            
            // Load inventory table
            loadInventoryTable('all');
            
            // Set settings toggle
            document.getElementById('requireApproval').checked = requireManagerApproval;
            
            // Add event listeners for navigation
            const navLinks = document.querySelectorAll('#adminDashboard .nav-links a[data-section]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links and sections
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('#adminDashboard .content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Show the corresponding section
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // Add event listener for logout
            document.getElementById('adminLogout').addEventListener('click', function(e) {
                e.preventDefault();
                handleLogout('Admin');
            });
            
            // Add event listeners for Add Staff form
            document.getElementById('addStaffBtn').addEventListener('click', function() {
                document.getElementById('addStaffForm').style.display = 'block';
                document.getElementById('staffForm').reset();
            });
            
            document.getElementById('cancelAddStaff').addEventListener('click', function() {
                document.getElementById('addStaffForm').style.display = 'none';
            });
            
            document.getElementById('staffForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addStaff();
            });
            
            // Add event listeners for Add Room form
            document.getElementById('addRoomBtn').addEventListener('click', function() {
                document.getElementById('addRoomForm').style.display = 'block';
                document.getElementById('roomForm').reset();
            });
            
            document.getElementById('cancelAddRoom').addEventListener('click', function() {
                document.getElementById('addRoomForm').style.display = 'none';
            });
            
            document.getElementById('roomForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addRoom();
            });
            
            // Add event listeners for Attendance filter
            document.getElementById('attendanceFilterType').addEventListener('change', function() {
                const filterType = this.value;
                document.querySelectorAll('.date-filter').forEach(filter => {
                    filter.style.display = 'none';
                });
                
                if (filterType === 'daily') {
                    document.getElementById('dailyFilter').style.display = 'block';
                } else if (filterType === 'monthly') {
                    document.getElementById('monthlyFilter').style.display = 'block';
                } else if (filterType === 'custom') {
                    document.getElementById('customFilter').style.display = 'block';
                }
            });
            
            document.getElementById('filterAttendance').addEventListener('click', function() {
                const filterType = document.getElementById('attendanceFilterType').value;
                
                if (filterType === 'daily') {
                    const date = document.getElementById('dailyDate').value;
                    loadAttendanceTable('daily', date);
                } else if (filterType === 'monthly') {
                    const monthYear = document.getElementById('monthYear').value;
                    loadAttendanceTable('monthly', monthYear);
                } else if (filterType === 'custom') {
                    const startDate = document.getElementById('startDate').value;
                    const endDate = document.getElementById('endDate').value;
                    loadAttendanceTable('custom', startDate, endDate);
                }
            });
            
            // Add event listeners for Staff Accounts
            document.getElementById('viewLedger').addEventListener('click', function() {
                const staffId = document.getElementById('staffSelect').value;
                loadStaffLedger(staffId);
            });
            
            document.getElementById('addTransaction').addEventListener('click', function() {
                document.getElementById('transactionForm').style.display = 'block';
                document.getElementById('staffTransactionForm').reset();
                loadTransactionStaffOptions();
            });
            
            document.getElementById('cancelTransaction').addEventListener('click', function() {
                document.getElementById('transactionForm').style.display = 'none';
            });
            
            document.getElementById('staffTransactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addStaffTransaction();
            });
            
            // Add event listeners for Inventory filter
            document.getElementById('filterInventory').addEventListener('click', function() {
                const filterType = document.getElementById('inventoryFilterType').value;
                loadInventoryTable(filterType);
            });
            
            // Add event listener for Settings form
            document.getElementById('requireApproval').addEventListener('change', function() {
                updateRequireApprovalSetting(this.checked);
            });
            
            document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changeAdminPassword();
            });
        }

        // Initialize Manager Dashboard
        function initManagerDashboard() {
            // Load stats for overview
            updateManagerOverviewStats();
            
            // Load staff table
            loadManagerStaffTable();
            
            // Load staff select for reports
            loadReportStaffOptions();
            
            // Load rooms table
            loadManagerRoomsTable();
            
            // Load booking requests
            loadBookingRequests();
            
            // Load inventory items
            loadInventoryItems();
            
            // Load salesperson select
            loadSalespersonOptions();
            
            // Add event listeners for navigation
            const navLinks = document.querySelectorAll('#managerDashboard .nav-links a[data-section]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links and sections
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('#managerDashboard .content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Show the corresponding section
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // Add event listener for logout
            document.getElementById('managerLogout').addEventListener('click', function(e) {
                e.preventDefault();
                handleLogout('Manager');
            });
            
            // Add event listeners for tab navigation
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const tabContainer = this.closest('.tabs').parentElement;
                    
                    // Remove active class from all buttons and tabs in this container
                    tabContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    tabContainer.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding tab
                    this.classList.add('active');
                    tabContainer.querySelector('#' + tabId).classList.add('active');
                });
            });
            
            // Add event listeners for reports form
            document.getElementById('staffReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitStaffReport();
            });
            
            // Add event listeners for stock forms
            document.getElementById('addStockForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewStock();
            });
            
            document.getElementById('applyStockFilter').addEventListener('click', function() {
                const filter = document.getElementById('stockFilter').value;
                loadStockTable(filter);
            });
            
            document.getElementById('moveStockForm').addEventListener('submit', function(e) {
                e.preventDefault();
                moveStockToRefrigerator();
            });
            
            // Add event listeners for handover forms
            document.getElementById('addHandoverItem').addEventListener('click', function() {
                addHandoverItemRow();
            });
            
            document.getElementById('salesHandoverForm').addEventListener('submit', function(e) {
                e.preventDefault();
                completeSalesHandover();
            });
            
            document.getElementById('returnSalesperson').addEventListener('change', function() {
                loadActiveHandovers(this.value);
            });
            
            document.getElementById('salesReturnForm').addEventListener('submit', function(e) {
                e.preventDefault();
                processSalesReturn();
            });
            
            // Add event listeners for salesperson management
            document.getElementById('viewSalespersonLedger').addEventListener('click', function() {
                const salespersonId = document.getElementById('salespersonSelect').value;
                loadSalespersonLedger(salespersonId);
            });
            
            // Add event listeners for report generation
            document.getElementById('reportPeriod').addEventListener('change', function() {
                const period = this.value;
                document.querySelectorAll('#reportDateSelectors > div').forEach(div => div.classList.add('hidden'));
                
                if (period === 'daily') {
                    document.getElementById('reportDailySelector').classList.remove('hidden');
                } else if (period === 'weekly') {
                    document.getElementById('reportWeeklySelector').classList.remove('hidden');
                } else if (period === 'monthly') {
                    document.getElementById('reportMonthlySelector').classList.remove('hidden');
                }
            });
            
            document.getElementById('generateReport').addEventListener('click', function() {
                generateReport();
            });
        }

        // Initialize Receptionist Dashboard
        function initReceptionistDashboard() {
            // Load stats for overview
            updateReceptionistOverviewStats();
            
            // Load available rooms
            loadAvailableRooms();
            
            // Set current date for attendance
            const currentDate = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = 'Current Date: ' + currentDate;
            
            // Load today's attendance
            loadTodayAttendance();
            
            // Load expected collection and today's bookings
            loadExpectedCollection();
            loadTodayBookings();
            
            // Add event listeners for navigation
            const navLinks = document.querySelectorAll('#receptionistDashboard .nav-links a[data-section]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links and sections
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('#receptionistDashboard .content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Show the corresponding section
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // Add event listener for logout
            document.getElementById('receptionistLogout').addEventListener('click', function(e) {
                e.preventDefault();
                handleLogout('Receptionist');
            });
            
            // Add event listeners for quick action buttons
            document.getElementById('quickBookRoom').addEventListener('click', function() {
                // Navigate to book room section
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelectorAll('#receptionistDashboard .content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelector('#receptionistDashboard .nav-links a[data-section="receptionistBookRoom"]').classList.add('active');
                document.getElementById('receptionistBookRoom').classList.add('active');
            });
            
            document.getElementById('quickTakeAttendance').addEventListener('click', function() {
                // Navigate to attendance section
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelectorAll('#receptionistDashboard .content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelector('#receptionistDashboard .nav-links a[data-section="receptionistAttendance"]').classList.add('active');
                document.getElementById('receptionistAttendance').classList.add('active');
            });
            
            document.getElementById('quickSubmitSales').addEventListener('click', function() {
                // Navigate to sales section
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelectorAll('#receptionistDashboard .content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelector('#receptionistDashboard .nav-links a[data-section="receptionistSales"]').classList.add('active');
                document.getElementById('receptionistSales').classList.add('active');
            });
            
            // Add event listeners for booking form
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                bookRoom();
            });
            
            // Add event listener for receipt modal close
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('receiptModal').style.display = 'none';
            });
            
            document.getElementById('printReceipt').addEventListener('click', function() {
                printReceipt();
            });
            
            // Add event listener for attendance form
            document.getElementById('attendanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                markAttendance();
            });
            
            // Add event listener for sales submission form
            document.getElementById('salesSubmissionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitDailySales();
            });
        }

        // Update Admin Overview Stats
        function updateAdminOverviewStats() {
            // Count rooms by status
            const roomsTransaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = roomsTransaction.objectStore('rooms');
            const roomsRequest = roomsStore.getAll();
            
            roomsRequest.onsuccess = (event) => {
                const rooms = event.target.result;
                const totalRooms = rooms.length;
                const availableRooms = rooms.filter(room => room.status === 'Available').length;
                const occupiedRooms = rooms.filter(room => room.status === 'Occupied').length;
                
                document.getElementById('adminTotalRooms').textContent = totalRooms;
                document.getElementById('adminAvailableRooms').textContent = availableRooms;
                document.getElementById('adminOccupiedRooms').textContent = occupiedRooms;
            };
            
            // Count total visitors (bookings)
            const bookingsTransaction = db.transaction(['bookings'], 'readonly');
            const bookingsStore = bookingsTransaction.objectStore('bookings');
            const bookingsRequest = bookingsStore.getAll();
            
            bookingsRequest.onsuccess = (event) => {
                const bookings = event.target.result;
                const totalVisitors = bookings.length;
                
                // Calculate room sales
                const roomSales = bookings.reduce((total, booking) => total + booking.amount, 0);
                
                document.getElementById('adminTotalVisitors').textContent = totalVisitors;
                document.getElementById('adminRoomSales').textContent = '$' + roomSales.toFixed(2);
            };
            
            // Calculate bar sales
            const salesHandoverTransaction = db.transaction(['salesHandovers'], 'readonly');
            const salesHandoverStore = salesHandoverTransaction.objectStore('salesHandovers');
            const salesHandoverRequest = salesHandoverStore.getAll();
            
            salesHandoverRequest.onsuccess = (event) => {
                const handovers = event.target.result;
                const barSales = handovers
                    .filter(handover => handover.status === 'Returned')
                    .reduce((total, handover) => total + handover.salesAmount, 0);
                
                document.getElementById('adminBarSales').textContent = '$' + barSales.toFixed(2);
            };
        }

        // Load Staff Table
        function loadStaffTable() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const tableBody = document.getElementById('staffTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add staff rows
                staff.forEach(employee => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${employee.id}</td>
                        <td>${employee.name}</td>
                        <td>${employee.role}</td>
                        <td>${employee.phone}</td>
                        <td>${employee.email}</td>
                        <td>${employee.active ? '<span class="status-active">Active</span>' : '<span class="status-inactive">Inactive</span>'}</td>
                        <td>
                            <button class="btn btn-sm btn-primary edit-staff" data-id="${employee.id}">Edit</button>
                            <button class="btn btn-sm ${employee.active ? 'btn-danger' : 'btn-success'} toggle-staff" data-id="${employee.id}" data-active="${employee.active}">
                                ${employee.active ? 'Deactivate' : 'Activate'}
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners for edit and toggle buttons
                document.querySelectorAll('.edit-staff').forEach(button => {
                    button.addEventListener('click', function() {
                        const staffId = parseInt(this.getAttribute('data-id'));
                        editStaff(staffId);
                    });
                });
                
                document.querySelectorAll('.toggle-staff').forEach(button => {
                    button.addEventListener('click', function() {
                        const staffId = parseInt(this.getAttribute('data-id'));
                        const currentActive = this.getAttribute('data-active') === 'true';
                        toggleStaffStatus(staffId, !currentActive);
                    });
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading staff table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff data.'
                });
            };
        }

        // Add New Staff
        function addStaff() {
            const name = document.getElementById('staffName').value;
            const phone = document.getElementById('staffPhone').value;
            const email = document.getElementById('staffEmail').value;
            const address = document.getElementById('staffAddress').value;
            const username = document.getElementById('staffUsername').value;
            const password = document.getElementById('staffPassword').value;
            const role = document.getElementById('staffRole').value;
            
            if (!name || !phone || !email || !address || !username || !password || !role) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields are required.'
                });
                return;
            }
            
            // Check if username already exists
            const userTransaction = db.transaction(['users'], 'readonly');
            const userStore = userTransaction.objectStore('users');
            const userRequest = userStore.get(username);
            
            userRequest.onsuccess = (event) => {
                const existingUser = event.target.result;
                
                if (existingUser) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Username already exists. Please choose a different username.'
                    });
                    return;
                }
                
                // Add new user to users store
                const userTransaction = db.transaction(['users'], 'readwrite');
                const userStore = userTransaction.objectStore('users');
                
                const newUser = {
                    username: username,
                    password: password,
                    role: role,
                    name: name,
                    active: true
                };
                
                const addUserRequest = userStore.add(newUser);
                
                addUserRequest.onsuccess = () => {
                    // Add staff details to staff store
                    const staffTransaction = db.transaction(['staff'], 'readwrite');
                    const staffStore = staffTransaction.objectStore('staff');
                    
                    const newStaff = {
                        username: username,
                        name: name,
                        role: role,
                        phone: phone,
                        email: email,
                        address: address,
                        active: true
                    };
                    
                    const addStaffRequest = staffStore.add(newStaff);
                    
                    addStaffRequest.onsuccess = () => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'New staff member added successfully.'
                        });
                        
                        // Close form and refresh staff table
                        document.getElementById('addStaffForm').style.display = 'none';
                        document.getElementById('staffForm').reset();
                        loadStaffTable();
                    };
                    
                    addStaffRequest.onerror = (event) => {
                        console.error('Error adding staff details:', event.target.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to add staff details.'
                        });
                    };
                };
                
                addUserRequest.onerror = (event) => {
                    console.error('Error adding user:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to add user.'
                    });
                };
            };
        }

        // Edit Staff
        function editStaff(staffId) {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.get(staffId);
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                
                if (!staff) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Staff not found.'
                    });
                    return;
                }
                
                // Show edit form with current values
                document.getElementById('staffForm').reset();
                document.getElementById('addStaffForm').style.display = 'block';
                
                document.getElementById('staffName').value = staff.name;
                document.getElementById('staffPhone').value = staff.phone;
                document.getElementById('staffEmail').value = staff.email;
                document.getElementById('staffAddress').value = staff.address;
                document.getElementById('staffUsername').value = staff.username;
                document.getElementById('staffUsername').readOnly = true;  // Don't allow changing username
                document.getElementById('staffPassword').placeholder = '(Leave blank to keep current password)';
                document.getElementById('staffRole').value = staff.role;
                
                // Change form submit handler to update instead of add
                const form = document.getElementById('staffForm');
                
                // Remove existing event listeners
                const newForm = form.cloneNode(true);
                form.parentNode.replaceChild(newForm, form);
                
                newForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    updateStaff(staffId);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error getting staff details:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to get staff details.'
                });
            };
        }

        // Update Staff
        function updateStaff(staffId) {
            const name = document.getElementById('staffName').value;
            const phone = document.getElementById('staffPhone').value;
            const email = document.getElementById('staffEmail').value;
            const address = document.getElementById('staffAddress').value;
            const username = document.getElementById('staffUsername').value;
            const password = document.getElementById('staffPassword').value;
            const role = document.getElementById('staffRole').value;
            
            if (!name || !phone || !email || !address || !username || !role) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields except password are required.'
                });
                return;
            }
            
            // Get the current staff record to update
            const staffTransaction = db.transaction(['staff'], 'readwrite');
            const staffStore = staffTransaction.objectStore('staff');
            const staffRequest = staffStore.get(staffId);
            
            staffRequest.onsuccess = (event) => {
                const staff = event.target.result;
                
                // Update staff details
                staff.name = name;
                staff.phone = phone;
                staff.email = email;
                staff.address = address;
                staff.role = role;
                
                // Update the staff record
                const updateStaffRequest = staffStore.put(staff);
                
                updateStaffRequest.onsuccess = () => {
                    // Update user record if role changed or password provided
                    const userTransaction = db.transaction(['users'], 'readwrite');
                    const userStore = userTransaction.objectStore('users');
                    const userRequest = userStore.get(username);
                    
                    userRequest.onsuccess = (event) => {
                        const user = event.target.result;
                        
                        if (user) {
                            user.role = role;
                            user.name = name;
                            
                            // Update password if provided
                            if (password) {
                                user.password = password;
                            }
                            
                            const updateUserRequest = userStore.put(user);
                            
                            updateUserRequest.onsuccess = () => {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Success',
                                    text: 'Staff details updated successfully.'
                                });
                                
                                // Close form and refresh staff table
                                document.getElementById('addStaffForm').style.display = 'none';
                                loadStaffTable();
                            };
                            
                            updateUserRequest.onerror = (event) => {
                                console.error('Error updating user:', event.target.error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Failed to update user details.'
                                });
                            };
                        }
                    };
                };
                
                updateStaffRequest.onerror = (event) => {
                    console.error('Error updating staff:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to update staff details.'
                    });
                };
            };
        }

        // Toggle Staff Status (Activate/Deactivate)
        function toggleStaffStatus(staffId, newStatus) {
            Swal.fire({
                title: newStatus ? 'Activate Staff' : 'Deactivate Staff',
                text: `Are you sure you want to ${newStatus ? 'activate' : 'deactivate'} this staff member?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    const staffTransaction = db.transaction(['staff'], 'readwrite');
                    const staffStore = staffTransaction.objectStore('staff');
                    const staffRequest = staffStore.get(staffId);
                    
                    staffRequest.onsuccess = (event) => {
                        const staff = event.target.result;
                        
                        if (!staff) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Staff not found.'
                            });
                            return;
                        }
                        
                        // Update staff active status
                        staff.active = newStatus;
                        
                        // Update the staff record
                        const updateStaffRequest = staffStore.put(staff);
                        
                        updateStaffRequest.onsuccess = () => {
                            // Also update the user record
                            const userTransaction = db.transaction(['users'], 'readwrite');
                            const userStore = userTransaction.objectStore('users');
                            const userRequest = userStore.get(staff.username);
                            
                            userRequest.onsuccess = (event) => {
                                const user = event.target.result;
                                
                                if (user) {
                                    user.active = newStatus;
                                    
                                    const updateUserRequest = userStore.put(user);
                                    
                                    updateUserRequest.onsuccess = () => {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Success',
                                            text: `Staff ${newStatus ? 'activated' : 'deactivated'} successfully.`
                                        });
                                        
                                        // Refresh staff table
                                        loadStaffTable();
                                    };
                                    
                                    updateUserRequest.onerror = (event) => {
                                        console.error('Error updating user status:', event.target.error);
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Error',
                                            text: 'Failed to update user status.'
                                        });
                                    };
                                }
                            };
                        };
                        
                        updateStaffRequest.onerror = (event) => {
                            console.error('Error updating staff status:', event.target.error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Failed to update staff status.'
                            });
                        };
                    };
                }
            });
        }

        // Load Rooms Table
        function loadRoomsTable() {
            const transaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = transaction.objectStore('rooms');
            const request = roomsStore.getAll();
            
            request.onsuccess = (event) => {
                const rooms = event.target.result;
                const tableBody = document.getElementById('roomTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add room rows
                rooms.forEach(room => {
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    if (room.status === 'Available') {
                        statusClass = 'status-available';
                    } else if (room.status === 'Occupied') {
                        statusClass = 'status-occupied';
                    } else if (room.status === 'Under Maintenance') {
                        statusClass = 'status-maintenance';
                    }
                    
                    row.innerHTML = `
                        <td>${room.roomNumber}</td>
                        <td>${room.description}</td>
                        <td>$${room.price}</td>
                        <td><span class="${statusClass}">${room.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary edit-room" data-room="${room.roomNumber}">Edit</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners for edit buttons
                document.querySelectorAll('.edit-room').forEach(button => {
                    button.addEventListener('click', function() {
                        const roomNumber = this.getAttribute('data-room');
                        editRoom(roomNumber);
                    });
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading rooms table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load room data.'
                });
            };
        }

        // Add New Room
        function addRoom() {
            const roomNumber = document.getElementById('roomNumber').value;
            const description = document.getElementById('roomDescription').value;
            const price = parseFloat(document.getElementById('roomPrice').value);
            const status = document.getElementById('roomStatus').value;
            const imageInput = document.getElementById('roomImage');
            
            if (!roomNumber || !description || isNaN(price)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Room number, description, and price are required.'
                });
                return;
            }
            
            // Check if room number already exists
            const transaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = transaction.objectStore('rooms');
            const request = roomsStore.get(roomNumber);
            
            request.onsuccess = (event) => {
                const existingRoom = event.target.result;
                
                if (existingRoom) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Room number already exists. Please use a different room number.'
                    });
                    return;
                }
                
                // Process image if provided
                let imagePromise = Promise.resolve(null);
                
                if (imageInput.files.length > 0) {
                    const file = imageInput.files[0];
                    const reader = new FileReader();
                    
                    imagePromise = new Promise((resolve, reject) => {
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.onerror = function() {
                            reject(new Error('Failed to read the image file'));
                        };
                        reader.readAsDataURL(file);
                    });
                }
                
                // Add the new room
                imagePromise.then(image => {
                    const writeTransaction = db.transaction(['rooms'], 'readwrite');
                    const roomsStore = writeTransaction.objectStore('rooms');
                    
                    const newRoom = {
                        roomNumber: roomNumber,
                        description: description,
                        price: price,
                        status: status,
                        image: image
                    };
                    
                    const addRequest = roomsStore.add(newRoom);
                    
                    addRequest.onsuccess = () => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'New room added successfully.'
                        });
                        
                        // Close form and refresh rooms table
                        document.getElementById('addRoomForm').style.display = 'none';
                        document.getElementById('roomForm').reset();
                        loadRoomsTable();
                        
                        // Update admin overview stats
                        updateAdminOverviewStats();
                    };
                    
                    addRequest.onerror = (event) => {
                        console.error('Error adding room:', event.target.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to add room.'
                        });
                    };
                }).catch(error => {
                    console.error('Error processing image:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to process room image.'
                    });
                });
            };
        }

        // Edit Room
        function editRoom(roomNumber) {
            const transaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = transaction.objectStore('rooms');
            const request = roomsStore.get(roomNumber);
            
            request.onsuccess = (event) => {
                const room = event.target.result;
                
                if (!room) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Room not found.'
                    });
                    return;
                }
                
                // Show edit form with current values
                document.getElementById('roomForm').reset();
                document.getElementById('addRoomForm').style.display = 'block';
                
                document.getElementById('roomNumber').value = room.roomNumber;
                document.getElementById('roomNumber').readOnly = true;  // Don't allow changing room number
                document.getElementById('roomDescription').value = room.description;
                document.getElementById('roomPrice').value = room.price;
                document.getElementById('roomStatus').value = room.status;
                
                // Change form submit handler to update instead of add
                const form = document.getElementById('roomForm');
                
                // Remove existing event listeners
                const newForm = form.cloneNode(true);
                form.parentNode.replaceChild(newForm, form);
                
                newForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    updateRoom(roomNumber);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error getting room details:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to get room details.'
                });
            };
        }

        // Update Room
        function updateRoom(roomNumber) {
            const description = document.getElementById('roomDescription').value;
            const price = parseFloat(document.getElementById('roomPrice').value);
            const status = document.getElementById('roomStatus').value;
            const imageInput = document.getElementById('roomImage');
            
            if (!description || isNaN(price)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Description and price are required.'
                });
                return;
            }
            
            // Get the current room record to update
            const roomTransaction = db.transaction(['rooms'], 'readwrite');
            const roomsStore = roomTransaction.objectStore('rooms');
            const roomRequest = roomsStore.get(roomNumber);
            
            roomRequest.onsuccess = (event) => {
                const room = event.target.result;
                
                // Process image if provided
                let imagePromise = Promise.resolve(room.image); // Keep existing image if no new one is provided
                
                if (imageInput.files.length > 0) {
                    const file = imageInput.files[0];
                    const reader = new FileReader();
                    
                    imagePromise = new Promise((resolve, reject) => {
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.onerror = function() {
                            reject(new Error('Failed to read the image file'));
                        };
                        reader.readAsDataURL(file);
                    });
                }
                
                // Update the room
                imagePromise.then(image => {
                    // Update room details
                    room.description = description;
                    room.price = price;
                    room.status = status;
                    if (image) {
                        room.image = image;
                    }
                    
                    // Update the room record
                    const updateRoomRequest = roomsStore.put(room);
                    
                    updateRoomRequest.onsuccess = () => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'Room details updated successfully.'
                        });
                        
                        // Close form and refresh rooms table
                        document.getElementById('addRoomForm').style.display = 'none';
                        loadRoomsTable();
                        
                        // Update admin overview stats
                        updateAdminOverviewStats();
                    };
                    
                    updateRoomRequest.onerror = (event) => {
                        console.error('Error updating room:', event.target.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to update room details.'
                        });
                    };
                }).catch(error => {
                    console.error('Error processing image:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to process room image.'
                    });
                });
            };
        }

        // Load Attendance Table
        function loadAttendanceTable(filterType, startDate, endDate) {
            const transaction = db.transaction(['attendance', 'staff'], 'readonly');
            const attendanceStore = transaction.objectStore('attendance');
            const staffStore = transaction.objectStore('staff');
            
            // Get all attendance records first
            const attendanceRequest = attendanceStore.getAll();
            
            attendanceRequest.onsuccess = (event) => {
                let attendance = event.target.result;
                
                // Apply filter
                if (filterType === 'daily') {
                    // Format should be YYYY-MM-DD
                    attendance = attendance.filter(record => record.date.split('T')[0] === startDate);
                } else if (filterType === 'monthly') {
                    // Format should be YYYY-MM
                    const yearMonth = startDate;
                    attendance = attendance.filter(record => record.date.startsWith(yearMonth));
                } else if (filterType === 'custom') {
                    // startDate and endDate should be YYYY-MM-DD
                    attendance = attendance.filter(record => {
                        const recordDate = record.date.split('T')[0];
                        return recordDate >= startDate && recordDate <= endDate;
                    });
                }
                
                // Sort by date (most recent first)
                attendance.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tableBody = document.getElementById('attendanceTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add attendance rows with staff details
                const processAttendance = async () => {
                    for (const record of attendance) {
                        const staffRequest = staffStore.get(record.staffId);
                        
                        await new Promise((resolve, reject) => {
                            staffRequest.onsuccess = (event) => {
                                const staff = event.target.result;
                                
                                if (staff) {
                                    const row = document.createElement('tr');
                                    
                                    const date = new Date(record.date).toLocaleDateString('en-US', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    });
                                    
                                    const time = new Date(record.date).toLocaleTimeString('en-US', {
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    row.innerHTML = `
                                        <td>${date}</td>
                                        <td>${record.staffId}</td>
                                        <td>${staff.name}</td>
                                        <td>${staff.role}</td>
                                        <td>Present</td>
                                        <td>${time}</td>
                                    `;
                                    
                                    tableBody.appendChild(row);
                                }
                                resolve();
                            };
                            
                            staffRequest.onerror = (event) => {
                                console.error('Error getting staff details:', event.target.error);
                                reject(event.target.error);
                            };
                        });
                    }
                };
                
                processAttendance().catch(error => {
                    console.error('Error processing attendance:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load attendance data.'
                    });
                });
            };
            
            attendanceRequest.onerror = (event) => {
                console.error('Error loading attendance table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load attendance data.'
                });
            };
        }

        // Load Staff Select Options
        function loadStaffSelectOptions() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const staffSelect = document.getElementById('staffSelect');
                
                // Clear current options except 'All Staff'
                while (staffSelect.options.length > 1) {
                    staffSelect.remove(1);
                }
                
                // Add staff options
                staff.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} (${employee.role})`;
                    staffSelect.appendChild(option);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading staff options:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff list.'
                });
            };
        }

        // Load Transaction Staff Options
        function loadTransactionStaffOptions() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const staffSelect = document.getElementById('transactionStaff');
                
                // Clear current options
                staffSelect.innerHTML = '';
                
                // Add staff options
                staff.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} (${employee.role})`;
                    staffSelect.appendChild(option);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading staff options:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff list.'
                });
            };
        }

        // Load Staff Ledger
        function loadStaffLedger(staffId) {
            const transaction = db.transaction(['transactions', 'staff'], 'readonly');
            const transactionsStore = transaction.objectStore('transactions');
            const staffStore = transaction.objectStore('staff');
            
            let transactions;
            let staff = null;
            
            if (staffId) {
                // Get specific staff transactions
                const staffRequest = staffStore.get(parseInt(staffId));
                
                staffRequest.onsuccess = (event) => {
                    staff = event.target.result;
                    
                    if (!staff) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Staff not found.'
                        });
                        return;
                    }
                    
                    const index = transactionsStore.index('staffId');
                    const request = index.getAll(parseInt(staffId));
                    
                    request.onsuccess = (event) => {
                        transactions = event.target.result;
                        displayLedger(transactions, staff);
                    };
                    
                    request.onerror = (event) => {
                        console.error('Error loading transactions:', event.target.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to load transaction data.'
                        });
                    };
                };
            } else {
                // Get all transactions
                const request = transactionsStore.getAll();
                
                request.onsuccess = (event) => {
                    transactions = event.target.result;
                    displayLedger(transactions);
                };
                
                request.onerror = (event) => {
                    console.error('Error loading transactions:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load transaction data.'
                    });
                };
            }
            
            function displayLedger(transactions, staff = null) {
                // Sort transactions by date
                transactions.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const tableBody = document.getElementById('accountLedgerTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add transaction rows
                const processTransactions = async () => {
                    let balance = 0;
                    
                    for (const transaction of transactions) {
                        let staffName = staff ? staff.name : '';
                        
                        if (!staff) {
                            // Get staff details for this transaction
                            const staffRequest = staffStore.get(transaction.staffId);
                            
                            await new Promise((resolve, reject) => {
                                staffRequest.onsuccess = (event) => {
                                    const staffData = event.target.result;
                                    if (staffData) {
                                        staffName = staffData.name;
                                    }
                                    resolve();
                                };
                                
                                staffRequest.onerror = (event) => {
                                    console.error('Error getting staff details:', event.target.error);
                                    reject(event.target.error);
                                };
                            });
                        }
                        
                        const row = document.createElement('tr');
                        
                        const date = new Date(transaction.date).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        });
                        
                        // Update balance
                        if (transaction.type === 'Credit') {
                            balance += transaction.amount;
                        } else {
                            balance -= transaction.amount;
                        }
                        
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>${transaction.staffId}</td>
                            <td>${staffName}</td>
                            <td>${transaction.description}</td>
                            <td>${transaction.type === 'Debit' ? '$' + transaction.amount.toFixed(2) : ''}</td>
                            <td>${transaction.type === 'Credit' ? '$' + transaction.amount.toFixed(2) : ''}</td>
                            <td>$${balance.toFixed(2)}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    }
                };
                
                processTransactions().catch(error => {
                    console.error('Error processing transactions:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load ledger data.'
                    });
                });
            }
        }

        // Add Staff Transaction
        function addStaffTransaction() {
            const staffId = parseInt(document.getElementById('transactionStaff').value);
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const description = document.getElementById('transactionDescription').value;
            
            if (!staffId || !type || isNaN(amount) || amount <= 0 || !description) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields are required. Amount must be greater than zero.'
                });
                return;
            }
            
            // Add the transaction
            const transaction = db.transaction(['transactions'], 'readwrite');
            const transactionsStore = transaction.objectStore('transactions');
            
            const newTransaction = {
                staffId: staffId,
                type: type,
                amount: amount,
                description: description,
                date: new Date().toISOString()
            };
            
            const request = transactionsStore.add(newTransaction);
            
            request.onsuccess = () => {
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: 'Transaction added successfully.'
                });
                
                // Close form and refresh ledger
                document.getElementById('transactionForm').style.display = 'none';
                document.getElementById('staffTransactionForm').reset();
                loadStaffLedger(staffId);
            };
            
            request.onerror = (event) => {
                console.error('Error adding transaction:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to add transaction.'
                });
            };
        }

        // Load Inventory Table
        function loadInventoryTable(filterType) {
            const transaction = db.transaction(['inventory', 'stockMovements'], 'readonly');
            const inventoryStore = transaction.objectStore('inventory');
            const stockMovementsStore = transaction.objectStore('stockMovements');
            
            // Get all inventory items
            const inventoryRequest = inventoryStore.getAll();
            
            inventoryRequest.onsuccess = (event) => {
                const inventory = event.target.result;
                const filteredInventory = filterType === 'all' 
                    ? inventory 
                    : inventory.filter(item => item.location === filterType);
                
                // Calculate aggregated data per item (combining batches)
                const itemsMap = {};
                
                filteredInventory.forEach(item => {
                    if (!itemsMap[item.name]) {
                        itemsMap[item.name] = {
                            id: item.id,
                            name: item.name,
                            category: item.category,
                            storeQuantity: 0,
                            refrigeratorQuantity: 0,
                            unitPrice: item.unitPrice,
                            totalValue: 0
                        };
                    }
                    
                    if (item.location === 'store') {
                        itemsMap[item.name].storeQuantity += item.quantity;
                    } else if (item.location === 'refrigerator') {
                        itemsMap[item.name].refrigeratorQuantity += item.quantity;
                    }
                    
                    // Use the most recent unit price
                    if (new Date(item.dateAdded) > new Date(itemsMap[item.name].dateAdded || 0)) {
                        itemsMap[item.name].unitPrice = item.unitPrice;
                        itemsMap[item.name].dateAdded = item.dateAdded;
                    }
                    
                    // Calculate total value
                    itemsMap[item.name].totalValue = 
                        (itemsMap[item.name].storeQuantity + itemsMap[item.name].refrigeratorQuantity) * 
                        itemsMap[item.name].unitPrice;
                });
                
                const aggregatedItems = Object.values(itemsMap);
                
                // Display inventory table
                const tableBody = document.getElementById('barInventoryTableBody');
                tableBody.innerHTML = '';
                
                aggregatedItems.forEach(item => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${item.storeQuantity}</td>
                        <td>${item.refrigeratorQuantity}</td>
                        <td>$${item.unitPrice.toFixed(2)}</td>
                        <td>$${item.totalValue.toFixed(2)}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // If viewing stock movements, display them too
                if (filterType === 'movements') {
                    document.getElementById('stockMovementTable').style.display = 'block';
                    loadStockMovements();
                } else {
                    document.getElementById('stockMovementTable').style.display = 'none';
                }
            };
            
            inventoryRequest.onerror = (event) => {
                console.error('Error loading inventory:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load inventory data.'
                });
            };
            
            function loadStockMovements() {
                // Get all stock movements
                const movementsRequest = stockMovementsStore.getAll();
                
                movementsRequest.onsuccess = (event) => {
                    const movements = event.target.result;
                    
                    // Sort movements by date (newest first)
                    movements.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    const movementsBody = document.getElementById('stockMovementTableBody');
                    movementsBody.innerHTML = '';
                    
                    const processMovements = async () => {
                        for (const movement of movements) {
                            const row = document.createElement('tr');
                            
                            // Get item details
                            const itemRequest = inventoryStore.get(movement.inventoryId);
                            
                            await new Promise((resolve, reject) => {
                                itemRequest.onsuccess = (event) => {
                                    const item = event.target.result;
                                    const itemName = item ? item.name : 'Unknown';
                                    
                                    const date = new Date(movement.date).toLocaleDateString('en-US', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    row.innerHTML = `
                                        <td>${date}</td>
                                        <td>${itemName}</td>
                                        <td>${movement.fromLocation}</td>
                                        <td>${movement.toLocation}</td>
                                        <td>${movement.quantity}</td>
                                        <td>${movement.moverId}</td>
                                    `;
                                    
                                    movementsBody.appendChild(row);
                                    resolve();
                                };
                                
                                itemRequest.onerror = (event) => {
                                    console.error('Error getting item details:', event.target.error);
                                    reject(event.target.error);
                                };
                            });
                        }
                    };
                    
                    processMovements().catch(error => {
                        console.error('Error processing movements:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to load stock movement data.'
                        });
                    });
                };
                
                movementsRequest.onerror = (event) => {
                    console.error('Error loading stock movements:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load stock movement data.'
                    });
                };
            }
        }

        // Update Require Approval Setting
        function updateRequireApprovalSetting(value) {
            const transaction = db.transaction(['settings'], 'readwrite');
            const settingsStore = transaction.objectStore('settings');
            
            const setting = {
                name: 'requireManagerApproval',
                value: value
            };
            
            const request = settingsStore.put(setting);
            
            request.onsuccess = () => {
                requireManagerApproval = value;
                
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: `Manager approval for bookings is now ${value ? 'required' : 'not required'}.`
                });
            };
            
            request.onerror = (event) => {
                console.error('Error updating setting:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to update setting.'
                });
            };
        }

        // Change Admin Password
        function changeAdminPassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields are required.'
                });
                return;
            }
            
            if (newPassword !== confirmPassword) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'New password and confirmation do not match.'
                });
                return;
            }
            
            // Verify current password
            const transaction = db.transaction(['users'], 'readonly');
            const usersStore = transaction.objectStore('users');
            const request = usersStore.get(currentUser.username);
            
            request.onsuccess = (event) => {
                const user = event.target.result;
                
                if (user.password !== currentPassword) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Current password is incorrect.'
                    });
                    return;
                }
                
                // Update password
                const updateTransaction = db.transaction(['users'], 'readwrite');
                const updateStore = updateTransaction.objectStore('users');
                
                user.password = newPassword;
                
                const updateRequest = updateStore.put(user);
                
                updateRequest.onsuccess = () => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: 'Password changed successfully.'
                    });
                    
                    document.getElementById('changePasswordForm').reset();
                    
                    // Update current user
                    currentUser = user;
                };
                
                updateRequest.onerror = (event) => {
                    console.error('Error updating password:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to update password.'
                    });
                };
            };
            
            request.onerror = (event) => {
                console.error('Error verifying password:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to verify current password.'
                });
            };
        }

        // Update Manager Overview Stats
        function updateManagerOverviewStats() {
            // Count staff
            const staffTransaction = db.transaction(['staff'], 'readonly');
            const staffStore = staffTransaction.objectStore('staff');
            const staffRequest = staffStore.getAll();
            
            staffRequest.onsuccess = (event) => {
                const staff = event.target.result;
                const activeStaff = staff.filter(s => s.active).length;
                
                document.getElementById('managerStaffCount').textContent = activeStaff;
            };
            
            // Count available rooms
            const roomsTransaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = roomsTransaction.objectStore('rooms');
            const roomsRequest = roomsStore.getAll();
            
            roomsRequest.onsuccess = (event) => {
                const rooms = event.target.result;
                const availableRooms = rooms.filter(room => room.status === 'Available').length;
                
                document.getElementById('managerAvailableRooms').textContent = availableRooms;
            };
            
            // Count bar stock items
            const inventoryTransaction = db.transaction(['inventory'], 'readonly');
            const inventoryStore = inventoryTransaction.objectStore('inventory');
            const inventoryRequest = inventoryStore.getAll();
            
            inventoryRequest.onsuccess = (event) => {
                const inventory = event.target.result;
                
                // Count unique items, not individual batches
                const uniqueItems = new Set();
                inventory.forEach(item => uniqueItems.add(item.name));
                
                document.getElementById('managerBarStock').textContent = uniqueItems.size;
            };
            
            // Calculate total sales (room + bar)
            const bookingsTransaction = db.transaction(['bookings'], 'readonly');
            const bookingsStore = bookingsTransaction.objectStore('bookings');
            const bookingsRequest = bookingsStore.getAll();
            
            bookingsRequest.onsuccess = (event) => {
                const bookings = event.target.result;
                const roomSales = bookings.reduce((total, booking) => total + booking.amount, 0);
                
                // Get bar sales
                const salesHandoverTransaction = db.transaction(['salesHandovers'], 'readonly');
                const salesHandoverStore = salesHandoverTransaction.objectStore('salesHandovers');
                const salesHandoverRequest = salesHandoverStore.getAll();
                
                salesHandoverRequest.onsuccess = (event) => {
                    const handovers = event.target.result;
                    const barSales = handovers
                        .filter(handover => handover.status === 'Returned')
                        .reduce((total, handover) => total + handover.salesAmount, 0);
                    
                    const totalSales = roomSales + barSales;
                    document.getElementById('managerTotalSales').textContent = '$' + totalSales.toFixed(2);
                };
            };
        }

        // Load Manager Staff Table
        function loadManagerStaffTable() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const tableBody = document.getElementById('managerStaffTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add staff rows
                staff.forEach(employee => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${employee.id}</td>
                        <td>${employee.name}</td>
                        <td>${employee.role}</td>
                        <td>${employee.phone}</td>
                        <td>${employee.active ? '<span class="status-active">Active</span>' : '<span class="status-inactive">Inactive</span>'}</td>
                        <td>
                            <button class="btn btn-sm btn-primary view-staff-attendance" data-id="${employee.id}">Attendance</button>
                            <button class="btn btn-sm btn-info view-staff-details" data-id="${employee.id}">Details</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners for buttons
                document.querySelectorAll('.view-staff-attendance').forEach(button => {
                    button.addEventListener('click', function() {
                        const staffId = parseInt(this.getAttribute('data-id'));
                        viewStaffAttendance(staffId);
                    });
                });
                
                document.querySelectorAll('.view-staff-details').forEach(button => {
                    button.addEventListener('click', function() {
                        const staffId = parseInt(this.getAttribute('data-id'));
                        viewStaffDetails(staffId);
                    });
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading staff table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff data.'
                });
            };
        }

        // View Staff Attendance
        function viewStaffAttendance(staffId) {
            const transaction = db.transaction(['attendance', 'staff'], 'readonly');
            const attendanceStore = transaction.objectStore('attendance');
            const staffStore = transaction.objectStore('staff');
            
            // Get staff details
            const staffRequest = staffStore.get(staffId);
            
            staffRequest.onsuccess = (event) => {
                const staff = event.target.result;
                
                if (!staff) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Staff not found.'
                    });
                    return;
                }
                
                // Get attendance records for this staff
                const index = attendanceStore.index('staffId');
                const attendanceRequest = index.getAll(staffId);
                
                attendanceRequest.onsuccess = (event) => {
                    const attendance = event.target.result;
                    
                    // Sort by date (most recent first)
                    attendance.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    // Display attendance in a modal
                    let attendanceHTML = '';
                    
                    if (attendance.length === 0) {
                        attendanceHTML = '<p>No attendance records found for this staff member.</p>';
                    } else {
                        attendanceHTML = `
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        attendance.forEach(record => {
                            const date = new Date(record.date).toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            });
                            
                            const time = new Date(record.date).toLocaleTimeString('en-US', {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            attendanceHTML += `
                                <tr>
                                    <td>${date}</td>
                                    <td>${time}</td>
                                    <td>Present</td>
                                </tr>
                            `;
                        });
                        
                        attendanceHTML += `
                                </tbody>
                            </table>
                        `;
                    }
                    
                    Swal.fire({
                        title: `Attendance for ${staff.name}`,
                        html: attendanceHTML,
                        width: 600,
                        showConfirmButton: true,
                        confirmButtonText: 'Close'
                    });
                };
                
                attendanceRequest.onerror = (event) => {
                    console.error('Error getting attendance records:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load attendance records.'
                    });
                };
            };
        }

        // View Staff Details
        function viewStaffDetails(staffId) {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            
            // Get staff details
            const staffRequest = staffStore.get(staffId);
            
            staffRequest.onsuccess = (event) => {
                const staff = event.target.result;
                
                if (!staff) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Staff not found.'
                    });
                    return;
                }
                
                // Display staff details in a modal
                const detailsHTML = `
                    <div class="staff-details">
                        <p><strong>ID:</strong> ${staff.id}</p>
                        <p><strong>Name:</strong> ${staff.name}</p>
                        <p><strong>Role:</strong> ${staff.role}</p>
                        <p><strong>Phone:</strong> ${staff.phone}</p>
                        <p><strong>Email:</strong> ${staff.email}</p>
                        <p><strong>Address:</strong> ${staff.address}</p>
                        <p><strong>Status:</strong> ${staff.active ? 'Active' : 'Inactive'}</p>
                    </div>
                `;
                
                Swal.fire({
                    title: 'Staff Details',
                    html: detailsHTML,
                    showConfirmButton: true,
                    confirmButtonText: 'Close'
                });
            };
            
            staffRequest.onerror = (event) => {
                console.error('Error getting staff details:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff details.'
                });
            };
        }

        // Load Report Staff Options
        function loadReportStaffOptions() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const staffSelect = document.getElementById('reportStaff');
                
                // Clear current options
                staffSelect.innerHTML = '';
                
                // Add staff options (excluding self/manager)
                staff.forEach(employee => {
                    if (employee.username !== currentUser.username && employee.active) {
                        const option = document.createElement('option');
                        option.value = employee.id;
                        option.textContent = `${employee.name} (${employee.role})`;
                        staffSelect.appendChild(option);
                    }
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading staff options:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load staff list.'
                });
            };
        }

        // Submit Staff Report
        function submitStaffReport() {
            const staffId = parseInt(document.getElementById('reportStaff').value);
            const description = document.getElementById('reportDescription').value;
            const type = document.querySelector('input[name="reportType"]:checked').value;
            const amount = parseFloat(document.getElementById('reportAmount').value);
            
            if (!staffId || !description || !type || isNaN(amount) || amount <= 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields are required. Amount must be greater than zero.'
                });
                return;
            }
            
            // Add the report
            const reportTransaction = db.transaction(['reports'], 'readwrite');
            const reportsStore = reportTransaction.objectStore('reports');
            
            const newReport = {
                staffId: staffId,
                type: type,
                description: description,
                amount: amount,
                date: new Date().toISOString(),
                status: 'Applied'
            };
            
            const reportRequest = reportsStore.add(newReport);
            
            reportRequest.onsuccess = () => {
                // Also add a corresponding transaction to staff account
                const transactionType = type === 'Penalty' ? 'Debit' : 'Credit';
                
                const transactionTransaction = db.transaction(['transactions'], 'readwrite');
                const transactionsStore = transactionTransaction.objectStore('transactions');
                
                const newTransaction = {
                    staffId: staffId,
                    type: transactionType,
                    amount: amount,
                    description: `${type} - ${description}`,
                    date: new Date().toISOString()
                };
                
                const transactionRequest = transactionsStore.add(newTransaction);
                
                transactionRequest.onsuccess = () => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: 'Staff report submitted and account updated.'
                    });
                    
                    // Reset form and reload reports
                    document.getElementById('staffReportForm').reset();
                    loadReports();
                };
                
                transactionRequest.onerror = (event) => {
                    console.error('Error adding transaction:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Report submitted but failed to update staff account.'
                    });
                };
            };
            
            reportRequest.onerror = (event) => {
                console.error('Error adding report:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to submit report.'
                });
            };
        }

        // Load Reports
        function loadReports() {
            const transaction = db.transaction(['reports', 'staff'], 'readonly');
            const reportsStore = transaction.objectStore('reports');
            const staffStore = transaction.objectStore('staff');
            
            // Get all reports
            const reportsRequest = reportsStore.getAll();
            
            reportsRequest.onsuccess = (event) => {
                const reports = event.target.result;
                
                // Sort by date (most recent first)
                reports.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tableBody = document.getElementById('reportsTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add report rows with staff details
                const processReports = async () => {
                    for (const report of reports) {
                        const staffRequest = staffStore.get(report.staffId);
                        
                        await new Promise((resolve, reject) => {
                            staffRequest.onsuccess = (event) => {
                                const staff = event.target.result;
                                
                                if (staff) {
                                    const row = document.createElement('tr');
                                    
                                    const date = new Date(report.date).toLocaleDateString('en-US', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    });
                                    
                                    row.innerHTML = `
                                        <td>${date}</td>
                                        <td>${staff.name}</td>
                                        <td>${report.type}</td>
                                        <td>$${report.amount.toFixed(2)}</td>
                                        <td>${report.description}</td>
                                        <td>${report.status}</td>
                                    `;
                                    
                                    tableBody.appendChild(row);
                                }
                                resolve();
                            };
                            
                            staffRequest.onerror = (event) => {
                                console.error('Error getting staff details:', event.target.error);
                                reject(event.target.error);
                            };
                        });
                    }
                };
                
                processReports().catch(error => {
                    console.error('Error processing reports:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load reports data.'
                    });
                });
            };
            
            reportsRequest.onerror = (event) => {
                console.error('Error loading reports:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load reports data.'
                });
            };
        }

        // Load Manager Rooms Table
        function loadManagerRoomsTable() {
            const transaction = db.transaction(['rooms'], 'readonly');
            const roomsStore = transaction.objectStore('rooms');
            const request = roomsStore.getAll();
            
            request.onsuccess = (event) => {
                const rooms = event.target.result;
                const tableBody = document.getElementById('managerRoomTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                // Add room rows
                rooms.forEach(room => {
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    if (room.status === 'Available') {
                        statusClass = 'status-available';
                    } else if (room.status === 'Occupied') {
                        statusClass = 'status-occupied';
                    } else if (room.status === 'Under Maintenance') {
                        statusClass = 'status-maintenance';
                    }
                    
                    row.innerHTML = `
                        <td>${room.roomNumber}</td>
                        <td>${room.description}</td>
                        <td>$${room.price}</td>
                        <td><span class="${statusClass}">${room.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning set-maintenance" data-room="${room.roomNumber}" ${room.status === 'Under Maintenance' ? 'disabled' : ''}>
                                Set Maintenance
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners for buttons
                document.querySelectorAll('.set-maintenance').forEach(button => {
                    button.addEventListener('click', function() {
                        const roomNumber = this.getAttribute('data-room');
                        setRoomMaintenance(roomNumber);
                    });
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading rooms table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load room data.'
                });
            };
        }

        // Set Room Maintenance
        function setRoomMaintenance(roomNumber) {
            Swal.fire({
                title: 'Set Room Maintenance',
                text: `Are you sure you want to mark Room ${roomNumber} as Under Maintenance?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    const transaction = db.transaction(['rooms'], 'readwrite');
                    const roomsStore = transaction.objectStore('rooms');
                    const request = roomsStore.get(roomNumber);
                    
                    request.onsuccess = (event) => {
                        const room = event.target.result;
                        
                        if (room.status === 'Occupied') {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Cannot set occupied rooms to maintenance. Please wait until the guest checks out.'
                            });
                            return;
                        }
                        
                        room.status = 'Under Maintenance';
                        
                        const updateRequest = roomsStore.put(room);
                        
                        updateRequest.onsuccess = () => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: `Room ${roomNumber} has been set to Under Maintenance.`
                            });
                            
                            // Refresh rooms table
                            loadManagerRoomsTable();
                            
                            // Update manager overview stats
                            updateManagerOverviewStats();
                        };
                        
                        updateRequest.onerror = (event) => {
                            console.error('Error updating room status:', event.target.error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Failed to update room status.'
                            });
                        };
                    };
                }
            });
        }

        // Load Booking Requests
        function loadBookingRequests() {
            const transaction = db.transaction(['bookings', 'rooms'], 'readonly');
            const bookingsStore = transaction.objectStore('bookings');
            const roomsStore = transaction.objectStore('rooms');
            
            // Get all bookings
            const bookingsRequest = bookingsStore.getAll();
            
            bookingsRequest.onsuccess = (event) => {
                const bookings = event.target.result;
                const pendingBookings = bookings.filter(booking => booking.status === 'Pending');
                
                const tableBody = document.getElementById('bookingRequestsTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                if (pendingBookings.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="7" class="text-center">No pending booking requests.</td>';
                    tableBody.appendChild(row);
                    return;
                }
                
                // Sort by date (most recent first)
                pendingBookings.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Add booking rows
                pendingBookings.forEach(booking => {
                    const row = document.createElement('tr');
                    
                    const date = new Date(booking.date).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    row.innerHTML = `
                        <td>${booking.id}</td>
                        <td>${date}</td>
                        <td>${booking.guestName}</td>
                        <td>${booking.roomNumber}</td>
                        <td>${booking.duration} days</td>
                        <td>$${booking.amount.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-success approve-booking" data-id="${booking.id}">
                                Approve
                            </button>
                            <button class="btn btn-sm btn-danger reject-booking" data-id="${booking.id}">
                                Reject
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners for buttons
                document.querySelectorAll('.approve-booking').forEach(button => {
                    button.addEventListener('click', function() {
                        const bookingId = parseInt(this.getAttribute('data-id'));
                        approveBooking(bookingId);
                    });
                });
                
                document.querySelectorAll('.reject-booking').forEach(button => {
                    button.addEventListener('click', function() {
                        const bookingId = parseInt(this.getAttribute('data-id'));
                        rejectBooking(bookingId);
                    });
                });
            };
            
            bookingsRequest.onerror = (event) => {
                console.error('Error loading booking requests:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load booking request data.'
                });
            };
        }

        // Approve Booking
        function approveBooking(bookingId) {
            const transaction = db.transaction(['bookings', 'rooms'], 'readwrite');
            const bookingsStore = transaction.objectStore('bookings');
            const roomsStore = transaction.objectStore('rooms');
            
            // Get the booking
            const bookingRequest = bookingsStore.get(bookingId);
            
            bookingRequest.onsuccess = (event) => {
                const booking = event.target.result;
                
                if (booking.status !== 'Pending') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'This booking has already been processed.'
                    });
                    return;
                }
                
                // Check if the room is still available
                const roomRequest = roomsStore.get(booking.roomNumber);
                
                roomRequest.onsuccess = (event) => {
                    const room = event.target.result;
                    
                    if (room.status !== 'Available') {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: `Room ${booking.roomNumber} is no longer available. Please reject this booking.`
                        });
                        return;
                    }
                    
                    // Update the booking status to Confirmed
                    booking.status = 'Confirmed';
                    
                    const updateBookingRequest = bookingsStore.put(booking);
                    
                    updateBookingRequest.onsuccess = () => {
                        // Update the room status to Occupied
                        room.status = 'Occupied';
                        
                        const updateRoomRequest = roomsStore.put(room);
                        
                        updateRoomRequest.onsuccess = () => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: `Booking #${bookingId} has been approved.`
                            });
                            
                            // Refresh booking requests
                            loadBookingRequests();
                            
                            // Update manager overview stats
                            updateManagerOverviewStats();
                        };
                    };
                };
            };
        }

        // Reject Booking
        function rejectBooking(bookingId) {
            Swal.fire({
                title: 'Reject Booking',
                text: 'Are you sure you want to reject this booking?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, Reject',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    const transaction = db.transaction(['bookings'], 'readwrite');
                    const bookingsStore = transaction.objectStore('bookings');
                    
                    // Get the booking
                    const bookingRequest = bookingsStore.get(bookingId);
                    
                    bookingRequest.onsuccess = (event) => {
                        const booking = event.target.result;
                        
                        if (booking.status !== 'Pending') {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'This booking has already been processed.'
                            });
                            return;
                        }
                        
                        // Update the booking status to Rejected
                        booking.status = 'Rejected';
                        
                        const updateBookingRequest = bookingsStore.put(booking);
                        
                        updateBookingRequest.onsuccess = () => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: `Booking #${bookingId} has been rejected.`
                            });
                            
                            // Refresh booking requests
                            loadBookingRequests();
                        };
                    };
                }
            });
        }

        // Load Inventory Items
        function loadInventoryItems() {
            // Load store items for move stock form
            loadStoreItems();
            
            // Load stock table
            loadStockTable('all');
            
            // Load refrigerator items for handover form
            loadRefrigeratorItems();
        }

        // Load Store Items
        function loadStoreItems() {
            const transaction = db.transaction(['inventory'], 'readonly');
            const inventoryStore = transaction.objectStore('inventory');
            
            // Get inventory items in store
            const index = inventoryStore.index('location');
            const request = index.getAll('store');
            
            request.onsuccess = (event) => {
                const items = event.target.result;
                const itemSelect = document.getElementById('moveStockItem');
                
                // Clear current options
                itemSelect.innerHTML = '';
                
                // Group items by name and batch
                const groupedItems = {};
                
                items.forEach(item => {
                    const key = `${item.name}-${item.batchId || 'no-batch'}`;
                    
                    if (!groupedItems[key]) {
                        groupedItems[key] = {
                            id: item.id,
                            name: item.name,
                            batchId: item.batchId,
                            quantity: 0
                        };
                    }
                    
                    groupedItems[key].quantity += item.quantity;
                });
                
                // Add options for items with quantity > 0
                Object.values(groupedItems)
                    .filter(item => item.quantity > 0)
                    .forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.batchId 
                            ? `${item.name} (Batch: ${item.batchId}, Qty: ${item.quantity})`
                            : `${item.name} (Qty: ${item.quantity})`;
                        option.dataset.quantity = item.quantity;
                        itemSelect.appendChild(option);
                    });
                
                // Update available quantity
                if (itemSelect.options.length > 0) {
                    const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                    document.getElementById('availableQuantity').textContent = 
                        `Available: ${selectedOption.dataset.quantity}`;
                }
                
                // Add event listener for change
                itemSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    document.getElementById('availableQuantity').textContent = 
                        `Available: ${selectedOption.dataset.quantity || 0}`;
                    
                    // Reset quantity input
                    document.getElementById('moveQuantity').value = '';
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading store items:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load store items.'
                });
            };
        }

        // Load Stock Table
        function loadStockTable(filterType) {
            const transaction = db.transaction(['inventory'], 'readonly');
            const inventoryStore = transaction.objectStore('inventory');
            
            let request;
            
            if (filterType === 'all') {
                request = inventoryStore.getAll();
            } else {
                const index = inventoryStore.index('location');
                request = index.getAll(filterType);
            }
            
            request.onsuccess = (event) => {
                const inventory = event.target.result;
                
                // Group items by name, batch, and location
                const groupedItems = {};
                
                inventory.forEach(item => {
                    const key = `${item.name}-${item.batchId || 'no-batch'}-${item.location}`;
                    
                    if (!groupedItems[key]) {
                        groupedItems[key] = {
                            id: item.id,
                            name: item.name,
                            category: item.category,
                            batchId: item.batchId,
                            location: item.location,
                            quantity: 0,
                            unitPrice: item.unitPrice
                        };
                    }
                    
                    groupedItems[key].quantity += item.quantity;
                });
                
                // Convert to array and sort by name
                const itemsArray = Object.values(groupedItems).sort((a, b) => a.name.localeCompare(b.name));
                
                const tableBody = document.getElementById('stockTableBody');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                if (itemsArray.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="7" class="text-center">No items found.</td>`;
                    tableBody.appendChild(row);
                    return;
                }
                
                // Add item rows
                itemsArray.forEach(item => {
                    const row = document.createElement('tr');
                    
                    const totalValue = item.quantity * item.unitPrice;
                    
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${item.batchId || 'N/A'}</td>
                        <td>${item.location === 'store' ? 'Store' : 'Refrigerator'}</td>
                        <td>${item.quantity}</td>
                        <td>$${item.unitPrice.toFixed(2)}</td>
                        <td>$${totalValue.toFixed(2)}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading stock table:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load stock data.'
                });
            };
        }

        // Load Refrigerator Items
        function loadRefrigeratorItems() {
            const transaction = db.transaction(['inventory'], 'readonly');
            const inventoryStore = transaction.objectStore('inventory');
            
            // Get inventory items in refrigerator
            const index = inventoryStore.index('location');
            const request = index.getAll('refrigerator');
            
            request.onsuccess = (event) => {
                const items = event.target.result;
                
                // Group items by name and batch
                const groupedItems = {};
                
                items.forEach(item => {
                    const key = `${item.name}-${item.batchId || 'no-batch'}`;
                    
                    if (!groupedItems[key]) {
                        groupedItems[key] = {
                            id: item.id,
                            name: item.name,
                            batchId: item.batchId,
                            quantity: 0,
                            unitPrice: item.unitPrice
                        };
                    }
                    
                    groupedItems[key].quantity += item.quantity;
                });
                
                // Store grouped items for later use in handover
                window.refrigeratorItems = Object.values(groupedItems)
                    .filter(item => item.quantity > 0)
                    .sort((a, b) => a.name.localeCompare(b.name));
                
                // Add first handover item row
                updateHandoverItemSelects();
            };
            
            request.onerror = (event) => {
                console.error('Error loading refrigerator items:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load refrigerator items.'
                });
            };
        }

        // Update Handover Item Selects
        function updateHandoverItemSelects() {
            const itemSelects = document.querySelectorAll('.handover-item-select');
            
            itemSelects.forEach(select => {
                // Save current value
                const currentValue = select.value;
                
                // Clear current options
                select.innerHTML = '';
                
                // Add empty option
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'Select Item';
                select.appendChild(emptyOption);
                
                // Add refrigerator items
                if (window.refrigeratorItems && window.refrigeratorItems.length > 0) {
                    window.refrigeratorItems.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.batchId 
                            ? `${item.name} (Batch: ${item.batchId})`
                            : item.name;
                        option.dataset.quantity = item.quantity;
                        select.appendChild(option);
                    });
                }
                
                // Restore value if possible
                if (currentValue) {
                    select.value = currentValue;
                }
                
                // Update available quantity
                updateAvailableQuantity(select);
                
                // Add change event listener
                select.addEventListener('change', function() {
                    updateAvailableQuantity(this);
                });
            });
        }

        // Update Available Quantity
        function updateAvailableQuantity(select) {
            const quantityDisplay = select.closest('.handover-item').querySelector('.available-quantity');
            const option = select.options[select.selectedIndex];
            
            if (option && option.dataset.quantity) {
                quantityDisplay.textContent = `Available: ${option.dataset.quantity}`;
            } else {
                quantityDisplay.textContent = 'Available: 0';
            }
            
            // Clear quantity input
            select.closest('.handover-item').querySelector('.handover-item-quantity').value = '';
        }

        // Add Handover Item Row
        function addHandoverItemRow() {
            const container = document.getElementById('handoverItems');
            
            // Create new item row
            const newItem = document.createElement('div');
            newItem.className = 'handover-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Select Item</label>
                    <select class="handover-item-select" required>
                        <!-- Items will be loaded dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" class="handover-item-quantity" required min="1">
                    <small class="available-quantity">Available: 0</small>
                </div>
                <button type="button" class="btn btn-sm btn-danger remove-item">Remove</button>
            `;
            
            container.appendChild(newItem);
            
            // Add event listener for remove button
            newItem.querySelector('.remove-item').addEventListener('click', function() {
                container.removeChild(newItem);
            });
            
            // Update item selects
            updateHandoverItemSelects();
        }

        // Add New Stock
        function addNewStock() {
            const name = document.getElementById('stockName').value;
            const category = document.getElementById('stockCategory').value;
            const quantity = parseInt(document.getElementById('stockQuantity').value);
            const unitPrice = parseFloat(document.getElementById('stockUnitPrice').value);
            const batchId = document.getElementById('stockBatchId').value || null;
            
            if (!name || !category || isNaN(quantity) || quantity <= 0 || isNaN(unitPrice) || unitPrice <= 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'All fields except Batch ID are required. Quantity and price must be greater than zero.'
                });
                return;
            }
            
            // Add the item to inventory
            const transaction = db.transaction(['inventory'], 'readwrite');
            const inventoryStore = transaction.objectStore('inventory');
            
            const newItem = {
                name: name,
                category: category,
                quantity: quantity,
                unitPrice: unitPrice,
                batchId: batchId,
                location: 'store',  // New items always go to store first
                dateAdded: new Date().toISOString()
            };
            
            const request = inventoryStore.add(newItem);
            
            request.onsuccess = () => {
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: `${quantity} ${name} added to store.`
                });
                
                // Reset form
                document.getElementById('addStockForm').reset();
                
                // Reload inventory items
                loadInventoryItems();
                
                // Update manager overview stats
                updateManagerOverviewStats();
            };
            
            request.onerror = (event) => {
                console.error('Error adding stock:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to add stock.'
                });
            };
        }

        // Move Stock to Refrigerator
        function moveStockToRefrigerator() {
            const itemId = parseInt(document.getElementById('moveStockItem').value);
            const quantity = parseInt(document.getElementById('moveQuantity').value);
            const availableQuantity = parseInt(document.getElementById('availableQuantity').textContent.split(': ')[1]);
            
            if (!itemId || isNaN(quantity) || quantity <= 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please select an item and enter a valid quantity.'
                });
                return;
            }
            
            if (quantity > availableQuantity) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: `Not enough quantity available. Maximum available: ${availableQuantity}`
                });
                return;
            }
            
            // Get the item details
            const transaction = db.transaction(['inventory', 'stockMovements'], 'readwrite');
            const inventoryStore = transaction.objectStore('inventory');
            const stockMovementsStore = transaction.objectStore('stockMovements');
            
            const itemRequest = inventoryStore.get(itemId);
            
            itemRequest.onsuccess = (event) => {
                const item = event.target.result;
                
                if (!item || item.location !== 'store') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Item not found or not in store.'
                    });
                    return;
                }
                
                // Determine how much to reduce from the store item
                const reduceQuantity = Math.min(quantity, item.quantity);
                
                // Update store item quantity or remove if zero
                if (reduceQuantity === item.quantity) {
                    // If using all quantity, update location to refrigerator
                    item.location = 'refrigerator';
                    const updateRequest = inventoryStore.put(item);
                    
                    updateRequest.onsuccess = () => {
                        recordStockMovement(item, 'store', 'refrigerator', reduceQuantity);
                    };
                } else {
                    // If partial quantity, reduce from store and add to refrigerator
                    item.quantity -= reduceQuantity;
                    
                    // Update store item
                    const updateRequest = inventoryStore.put(item);
                    
                    updateRequest.onsuccess = () => {
                        // Create new refrigerator item
                        const newRefrigeratorItem = {
                            name: item.name,
                            category: item.category,
                            quantity: reduceQuantity,
                            unitPrice: item.unitPrice,
                            batchId: item.batchId,
                            location: 'refrigerator',
                            dateAdded: item.dateAdded  // Preserve original date for FIFO
                        };
                        
                        // Add refrigerator item
                        const addRequest = inventoryStore.add(newRefrigeratorItem);
                        
                        addRequest.onsuccess = (event) => {
                            const newItemId = event.target.result;
                            newRefrigeratorItem.id = newItemId;
                            recordStockMovement(newRefrigeratorItem, 'store', 'refrigerator', reduceQuantity);
                        };
                    };
                }
            };
            
            function recordStockMovement(item, fromLocation, toLocation, moveQuantity) {
                // Record stock movement
                const movement = {
                    inventoryId: item.id,
                    fromLocation: fromLocation,
                    toLocation: toLocation,
                    quantity: moveQuantity,
                    date: new Date().toISOString(),
                    moverId: currentUser.username
                };
                
                const movementRequest = stockMovementsStore.add(movement);
                
                movementRequest.onsuccess = () => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: `${moveQuantity} ${item.name} moved to refrigerator.`
                    });
                    
                    // Reset form
                    document.getElementById('moveStockForm').reset();
                    document.getElementById('availableQuantity').textContent = 'Available: 0';
                    
                    // Reload inventory items
                    loadInventoryItems();
                };
                
                movementRequest.onerror = (event) => {
                    console.error('Error recording stock movement:', event.target.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to record stock movement.'
                    });
                };
            }
        }

        // Load Salesperson Options
        function loadSalespersonOptions() {
            const transaction = db.transaction(['staff'], 'readonly');
            const staffStore = transaction.objectStore('staff');
            const roleIndex = staffStore.index('role');
            
            // Get staff with role 'Staff' (salespersons)
            const request = staffStore.getAll();
            
            request.onsuccess = (event) => {
                const staff = event.target.result;
                const salesStaff = staff.filter(s => s.active && (s.role === 'Staff' || s.role === 'Salesperson'));
                
                const handoverSelect = document.getElementById('handoverSalesperson');
                const returnSelect = document.getElementById('returnSalesperson');
                const salespersonSelect = document.getElementById('salespersonSelect');
                
                // Clear current options
                handoverSelect.innerHTML = '';
                returnSelect.innerHTML = '';
                
                // Add empty option
                const emptyOption1 = document.createElement('option');
                emptyOption1.value = '';
                emptyOption1.textContent = 'Select Salesperson';
                handoverSelect.appendChild(emptyOption1);
                
                const emptyOption2 = document.createElement('option');
                emptyOption2.value = '';
                emptyOption2.textContent = 'Select Salesperson';
                returnSelect.appendChild(emptyOption2);
                
                // Clear salesperson select except 'All Salespeople'
                while (salespersonSelect.options.length > 1) {
                    salespersonSelect.remove(1);
                }
                
                // Add salesperson options
                salesStaff.forEach(staff => {
                    // For handover select
                    const option1 = document.createElement('option');
                    option1.value = staff.id;
                    option1.textContent = staff.name;
                    handoverSelect.appendChild(option1);
                    
                    // For return select
                    const option2 = document.createElement('option');
                    option2.value = staff.id;
                    option2.textContent = staff.name;
                    returnSelect.appendChild(option2);
                    
                    // For salesperson select
                    const option3 = document.createElement('option');
                    option3.value = staff.id;
                    option3.textContent = staff.name;
                    salespersonSelect.appendChild(option3);
                });
            };
            
            request.onerror = (event) => {
                console.error('Error loading salesperson options:', event.target.error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load salesperson list.'
                });
            };
        }

        // Complete Sales Handover
        function completeSalesHandover() {
            const salespersonId = parseInt(document.getElementById('handoverSalesperson').value);
            const itemElements = document.querySelectorAll('.handover-item');
            
            if (!salespersonId) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please select a salesperson.'
                });
                return;
            }
            
            const items = [];
            let valid = true;
            
            itemElements.forEach(element => {
                const selectElement = element.querySelector('.handover-item-select');
                const quantityElement = element.querySelector('.handover-item-quantity');
                
                const itemId = parseInt(selectElement.value);
                const quantity = parseInt(quantityElement.value);
                const availableQuantity = parseInt(element.querySelector('.available-quantity').textContent.split(': ')[1]);
                
                if (!itemId || isNaN(quantity) || quantity <= 0) {
                    valid = false;
                    return;
                }
                
                if (quantity > availableQuantity) {
                    valid = false;
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: `Not enough quantity available for one or more items.`
                    });
                    return;
                }
                
                // Check if item already exists in the items array
                const existingItem = items.find(item => item.itemId === itemId);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    items.push({
                        itemId: itemId,
                        quantity: quantity
                    });
                }
            });
            
            if (!valid || items.length === 0) {
                if (items.length === 0) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please add at least one item.'
                    });
                }
                return;
            }
            
            // Create handover record
            const transaction = db.transaction(['salesHandovers', 'inventory'], 'readwrite');
            const salesHandoversStore = transaction.objectStore('salesHandovers');
            const inventoryStore = transaction.objectStore('inventory');
            
            // Calculate total value of items
            let totalValue = 0;
            let processedItems = 0;
            
            // Process each item
            items.forEach(item => {
                const itemRequest = inventoryStore.get(item.itemId);
                
                itemRequest.onsuccess = (event) => {
                    const inventoryItem = event.target.result;
                    
                    if (!inventoryItem) {
                        valid = false;
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'One or more items not found in inventory.'
                        });
                        return;
                    }
                    
                    // Calculate item value
                    const itemValue = inventoryItem.unitPrice * item.quantity;
                    totalValue += itemValue;
                    
                    // Update item quantity
                    if (item.quantity === inventoryItem.quantity) {
                        // Remove item if all quantity is used
                        const deleteRequest = inventoryStore.delete(item.itemId);
                        
                        deleteRequest.onerror = (event) => {
                            console.error('Error deleting inventory item:', event.target.error);
                            valid = false;
                        };
                    } else {
                        // Update quantity otherwise
                        inventoryItem.quantity -= item.quantity;
                        
                        const updateRequest = inventoryStore.put(inventoryItem);
                        
                        updateRequest.onerror = (event) => {
                            console.error('Error updating inventory item:', event.target.error);
                            valid = false;
                        };
                    }
                    
                    processedItems++;
                    
                    // If all items are processed, create the handover record
                    if (processedItems === items.length && valid) {
                        const handover = {
                            salespersonId: salespersonId,
                            date: new Date().toISOString(),
                            items: items,
                            totalValue: totalValue,
                            status: 'Handed Over',
                            managerId: currentUser.username
                        };
                        
                        const handoverRequest = salesHandoversStore.add(handover);
                        
                        handoverRequest.onsuccess = () => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: `Items handed over to salesperson. Total value: $${totalValue.toFixed(2)}`
                            });
                            
                            // Reset form
                            document.getElementById('salesHandoverForm').reset();
                            
                            // Clear handover items except first one
                            const container = document.getElementById('handoverItems');
                            while (container.children.length > 1) {
                                container.removeChild(container.lastChild);
                            }
                            
                            // Reset first item
                            container.firstChild.querySelector('.handover-item-select').value = '';
                            container.firstChild.querySelector('.handover-item-quantity').value = '';
                            container.firstChild.querySelector('.available-quantity').textContent = 'Available: 0';
                            
                            // Reload inventory items
                            loadInventoryItems();
                        };
                        
                        handoverRequest.onerror = (event) => {
                            console.error('Error creating handover record:', event.target.error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Failed to complete handover.'
                            });
                        };
                    }
                };
                
                itemRequest.onerror = (event) => {
                    console.error('Error getting inventory item:', event.target.error);
                    valid = false;
                };
            });
        }

        // Load Active Handovers
        function loadActiveHandovers(salespersonId) {
            if (!salespersonId) {
                document.getElementById('activeHandovers').innerHTML = '<p>Select a salesperson to view active handovers.</p>';
                document.getElementById('returnItems').classList.add('hidden');
                return;
            }
            
            const transaction = db.transaction(['salesHandovers', 'inventory', 'staff'], 'readonly');
            const salesHandoversStore = transaction.objectStore('salesHandovers');
            const staffStore = transaction.objectStore('staff');
            const inventoryStore = transaction.objectStore('inventory');
            
            // Get staff details
            const staffRequest = staffStore.get(parseInt(salespersonId));
            
            staffRequest.onsuccess = (event) => {
                const staff = event.target.result;
                
                if (!staff) {
                    document.getElementById('activeHandovers').innerHTML = '<p>Salesperson not found.</p>';
                    document.getElementById('returnItems').classList.add('hidden');
                    return;
                }
                
                // Get active handovers
                const index = salesHandoversStore.index('salespersonId');
                const handoverRequest = index.getAll(parseInt(salespersonId));
                
                handoverRequest.onsuccess = (event) => {
                    const handovers = event.target.result;
                    const activeHandovers = handovers.filter(h => h.status === 'Handed Over');
                    
                    if (activeHandovers.length === 0) {
                        document.getElementById('activeHandovers').innerHTML = '<p>No active handovers found for this salesperson.</p>';
                        document.getElementById('returnItems').classList.add('hidden');
                        return;
                    }
                    
                    // Sort by date (newest first)
                    activeHandovers.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    // Take the most recent handover
                    const handover = activeHandovers[0];
                    
                    // Format date
                    const handoverDate = new Date(handover.date).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Display handover details
                    let handoverDetails = `
                        <div class="handover-details">
                            <p><strong>Handover Date:</strong> ${handoverDate}</p>
                            <p><strong>Total Value:</strong> $${handover.totalValue.toFixed(2)}</p>
                            <h4>Handed Over Items:</h4>
                            <ul>
                    `;
                    
                    // Process items
                    let processedItems = 0;
                    
                    handover.items.forEach(item => {
                        const itemRequest = inventoryStore.get(item.itemId);
                        
                        itemRequest.onsuccess = (event) => {
                            const inventoryItem = event.target.result;
                            let itemName = 'Unknown Item';
                            
                            if (inventoryItem) {
                                itemName = inventoryItem.name;
                            } else {
                                // Item might have been deleted, try to find it by ID in all items
                                // This is a fallback and might not always work
                                const allItemsRequest = inventoryStore.getAll();
                                
                                allItemsRequest.onsuccess = (e) => {
                                    const allItems = e.target.result;
                                    const matchingItem = allItems.find(i => i.id === item.itemId);
                                    
                                    if (matchingItem) {
                                        itemName = matchingItem.name;
                                    }
                                    
                                    handoverDetails += `<li>${itemName} - Quantity: ${item.quantity}</li>`;
                                    processedItems++;
                                    
                                    if (processedItems === handover.items.length) {
                                        finishHandoverDisplay();
                                    }
                                };
                                
                                return;
                            }
                            
                            handoverDetails += `<li>${itemName} - Quantity: ${item.quantity}</li>`;
                            processedItems++;
                            
                            if (processedItems === handover.items.length) {
                                finishHandoverDisplay();
                            }
                        };
                        
                        itemRequest.onerror = () => {
                            handoverDetails += `<li>Unknown Item - Quantity: ${item.quantity}</li>`;
                            processedItems++;
                            
                            if (processedItems === handover.items.length) {
                                finishHandoverDisplay();
                            }
                        };
                    });
                    
                    function finishHandoverDisplay() {
                        handoverDetails += `
                            </ul>
                        </div>
                        `;
                        
                        document.getElementById('activeHandovers').innerHTML = handoverDetails;
                        
                        // Show return items form
                        document.getElementById('returnItems').classList.remove('hidden');
                        
                        // Generate return items form
                        const returnItemsList = document.getElementById('returnItemsList');
                        returnItemsList.innerHTML = '';
                        
                        handover.items.forEach(item => {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'return-item';
                            
                            let itemName = 'Unknown Item';
                            // Find item name in the handover details we just created
                            const itemMatch = handoverDetails.match(new RegExp(`<li>(.*) - Quantity: ${item.quantity}</li>`));
                            if (itemMatch && itemMatch[1]) {
                                itemName = itemMatch[1];
                            }
                            
                            itemDiv.innerHTML = `
                                <div class="form-group">
                                    <label>${itemName}</label>
                                    <input type="number" class="return-item-quantity" 
                                           data-item-id="${item.itemId}" data-original-quantity="${item.quantity}"
                                           placeholder="Enter quantity returned" max="${item.quantity}" required>
                                    <small>Handed Over: ${item.quantity}</small>
                                </div>
                            `;
                            
                            returnItemsList.appendChild(itemDiv);
                        });
                        
                        // Store handover ID for submission
                        document.getElementById('returnItems').dataset.handoverId = handover.id;
                    }
                };
            };
        }

        // Process Sales Return
        function processSalesReturn() {
            const salespersonId = parseInt(document.getElementById('returnSalesperson').value);
            const handoverId = parseInt(document.getElementById('returnItems').dataset.handoverId);
            const salesAmount = parseFloat(document.getElementById('salesAmount').value);
            
            if (!salespersonId || !handoverId || isNaN(salesAmount) || salesAmount < 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please select a salesperson and enter a valid sales amount.'
                });
                return;
            }
            
            // Collect returned quantities
            const returnItems = [];
            const returnInputs = document.querySelectorAll('.return-item-quantity');
            let valid = true;
            
            returnInputs.forEach(input => {
                const itemId = parseInt(input.dataset.itemId);
                const originalQuantity = parseInt(input.dataset.originalQuantity);
                const returnedQuantity = parseInt(input.value);
                
                if (isNaN(returnedQuantity) || returnedQuantity < 0 || returnedQuantity > originalQuantity) {
                    valid = false;
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please enter valid return quantities.'
                    });
                    return;
                }
                
                returnItems.push({
                    itemId: itemId,
                    originalQuantity: originalQuantity,
                    returnedQuantity: returnedQuantity,
                    soldQuantity: originalQuantity - returnedQuantity
                });
            });
            
            if (!valid) {
                return;
            }
            
            // Process the return
            const transaction = db.transaction(['salesHandovers', 'transactions', 'inventory'], 'readwrite');
            const salesHandoversStore = transaction.objectStore('salesHandovers');
            const transactionsStore = transaction.objectStore('transactions');
            const inventoryStore = transaction.objectStore('inventory');
            
            // Get the handover
            const handoverRequest = salesHandoversStore.get(handoverId);
            
            handoverRequest.onsuccess = (event) => {
                const handover = event.target.result;
                
                if (!handover || handover.status !== 'Handed Over') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Handover not found or already processed.'
                    });
                    return;
                }
                
                // Calculate expected amount based on sold quantities
                let expectedValue = 0;
                let processedItems = 0;
                
                // Process returned items
                returnItems.forEach(returnItem => {
                    const originalItem = handover.items.find(item => item.itemId === returnItem.itemId);
                    
                    if (!originalItem) {
                        valid = false;
                        return;
                    }
                    
                    // For returned items, add them back to inventory (to the store)
                    if (returnItem.returnedQuantity > 0) {
                        // Try to find the item in inventory first to get details
                        const itemRequest = inventoryStore.get(returnItem.itemId);
                        
                        itemRequest.onsuccess = (event) => {
                            let item = event.target.result;
                            
                            if (item) {
                                // Item still exists in inventory, update quantity
                                item.quantity += returnItem.returnedQuantity;
                                inventoryStore.put(item);
                            } else {
                                // Item might have been fully handed over, check other items
                                // This is more complex and would require finding the original item details
                                // For simplicity, we'll assume it was deleted and create a new one
                                // with default values
                                
                                // In a real application, you would store more item details
                                // in the handover record to handle this case
                                
                                // Get all items to try to find similar ones
                                const allItemsRequest = inventoryStore.getAll();
                                
                                allItemsRequest.onsuccess = (e) => {
                                    const allItems = e.target.result;
                                    
                                    // Try to find a similar item by name
                                    let itemName = 'Returned Item';
                                    let itemCategory = 'Other';
                                    let itemUnitPrice = 0;
                                    
                                    // Calculate unit price from handover value
                                    if (originalItem.quantity > 0) {
                                        itemUnitPrice = handover.totalValue / handover.items.reduce((sum, i) => sum + i.quantity, 0);
                                    }
                                    
                                    // Create new inventory item
                                    const newItem = {
                                        name: itemName,
                                        category: itemCategory,
                                        quantity: returnItem.returnedQuantity,
                                        unitPrice: itemUnitPrice,
                                        batchId: null,
                                        location: 'store',  // Return to store
                                        dateAdded: new Date().toISOString()
                                    };
                                    
                                    inventoryStore.add(newItem);
                                };
                            }
                        };
                    }
                    
                    // Calculate expected value for sold items
                    const itemValue = (handover.totalValue / handover.items.reduce((sum, i) => sum + i.quantity, 0)) * returnItem.soldQuantity;
                    expectedValue += itemValue;
                    
                    processedItems++;
                    
                    // If all items are processed, finalize the return
                    if (processedItems === returnItems.length && valid) {
                        finalizeReturn();
                    }
                });
                
                function finalizeReturn() {
                    // Update handover status
                    handover.status = 'Returned';
                    handover.returnDate = new Date().toISOString();
                    handover.salesAmount = salesAmount;
                    handover.returnItems = returnItems;
                    handover.expectedValue = expectedValue;
                    
                    // Calculate difference (shortfall or overpayment)
                    const difference = salesAmount - expectedValue;
                    handover.difference = difference;
                    
                    // Update handover record
                    const updateHandoverRequest = salesHandoversStore.put(handover);
                    
                    updateHandoverRequest.onsuccess = () => {
                        // If there's a difference, create a transaction
                        if (difference !== 0) {
                            const transactionType = difference < 0 ? 'Debit' : 'Credit';
                            const transactionAmount = Math.abs(difference);
                            const description = difference < 0 
                                ? `Sales Shortfall (${new Date().toLocaleDateString()})` 
                                : `Sales Overpayment (${new Date().toLocaleDateString()})`;
                            
                            const newTransaction = {
                                staffId: salespersonId,
                                type: transactionType,
                                amount: transactionAmount,
                                description: description,
                                date: new Date().toISOString()
                            };
                            
                            const transactionRequest = transactionsStore.add(newTransaction);
                            
                            transactionRequest.onsuccess = () => {
                                showSuccessMessage();
                            };
                            
                            transactionRequest.onerror = (event) => {
                                console.error('Error adding transaction:', event.target.error);
                                showSuccessMessage('Transaction record could not be created.');
                            };
                        } else {
                            showSuccessMessage();
                        }
                    };
                    
                    updateHandoverRequest.onerror = (event) => {
                        console.error('Error updating handover record:', event.target.error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Failed to process return.'
                        });
                    };
                }
                
                function showSuccessMessage(warning = null) {
                    let message = `Return processed successfully. Sales amount: $${salesAmount.toFixed(2)}`;
                    
                    if (difference !== 0) {
                        if (difference < 0) {
                            message += `\nShortfall: $${Math.abs(difference).toFixed(2)} (deducted from staff account)`;
                        } else {
                            message += `\nOverpayment: $${difference.toFixed(2)} (added to staff account as bonus)`;
                        }
                    }
                    
                    if (warning) {
                        message += `\nWarning: ${warning}`;
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: message
                    });
                    
                    // Reset form
                    document.getElementById('salesReturnForm').reset();
                    document.getElementById('activeHandovers').innerHTML = '<p>Select a salesperson to view active handovers.</p>';
                    document.getElementById('returnItems').classList.add('hidden');
                    
                    // Reload inventory items
                    loadInventoryItems();
                }
            };
        }

        // Load Salesperson Ledger
        function loadSalespersonLedger(salespersonId) {
            // Similar to Admin loadStaffLedger but focused on sales handovers
            const transaction = db.transaction(['salesHandovers', 'transactions', 'staff'], 'readonly');
            const salesHandoversStore = transaction.objectStore('salesHandovers');
            const transactionsStore = transaction.objectStore('transactions');
            const staffStore = transaction.objectStore('staff');
            
            let salespersonName = '';
            
            // Get the selected salesperson
            if (salespersonId) {
                const staffRequest = staffStore.get(parseInt(salespersonId));
                
                staffRequest.onsuccess = (event) => {
                    const staff = event.target.result;
                    
                    if (staff) {
                        salespersonName = staff.name;
                        
                        // Get handovers for this salesperson
                        const handoversIndex = salesHandoversStore.index('salespersonId');
                        const handoversRequest = handoversIndex.getAll(parseInt(salespersonId));
                        
                        handoversRequest.onsuccess = (event) => {
                            const handovers = event.target.result;
                            
                            // Get transactions for this salesperson
                            const transactionsIndex = transactionsStore.index('staffId');
                            const transactionsRequest = transactionsIndex.getAll(parseInt(salespersonId));
                            
                            transactionsRequest.onsuccess = (event) => {
                                const transactions = event.target.result;
                                displayLedger(salespersonId, salespersonName, handovers, transactions);
                            };
                        };
                    } else {
                        displayLedger(null, '', [], []);
                    }
                };
            } else {
                // Get all handovers
                const handoversRequest = salesHandoversStore.getAll();
                
                handoversRequest.onsuccess = (event) => {
                    const handovers = event.target.result;
                    
                    // Get all transactions
                    const transactionsRequest = transactionsStore.getAll();
                    
                    transactionsRequest.onsuccess = (event) => {
                        const transactions = event.target.result;
                        displayLedger(null, '', handovers, transactions);
                    };
                };
            }
            
            function displayLedger(salespersonId, salespersonName, handovers, transactions) {
                const tableBody = document.getElementById('salespersonLedgerTableBody');
                tableBody.innerHTML = '';
                
                // If no salesperson selected, show summary for all
                if (!salespersonId) {
                    // Group handovers by salesperson
                    const salespersonHandovers = {};
                    
                    handovers.forEach(handover => {
                        if (!salespersonHandovers[handover.salespersonId]) {
                            salespersonHandovers[handover.salespersonId] = [];
                        }
                        salespersonHandovers[handover.salespersonId].push(handover);
                    });
                    
                    // For each salesperson, show summary
                    Object.entries(salespersonHandovers).forEach(async ([id, handovers]) => {
                        const staffRequest = staffStore.get(parseInt(id));
                        
                        try {
                            await new Promise((resolve, reject) => {
                                staffRequest.onsuccess = (event) => {
                                    const staff = event.target.result;
                                    
                                    if (staff) {
                                        // Calculate totals
                                        const totalHandoverValue = handovers
                                            .filter(h => h.status === 'Returned')
                                            .reduce((sum, h) => sum + h.totalValue, 0);
                                        
                                        const totalSalesAmount = handovers
                                            .filter(h => h.status === 'Returned')
                                            .reduce((sum, h) => sum + h.salesAmount, 0);
                                        
                                        const totalBalance = transactions
                                            .filter(t => t.staffId === parseInt(id))
                                            .reduce((balance, t) => balance + (t.type === 'Credit' ? t.amount : -t.amount), 0);
                                        
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                            <td colspan="2">${staff.name}</td>
                                            <td>$${totalHandoverValue.toFixed(2)}</td>
                                            <td>-</td>
                                            <td>$${totalSalesAmount.toFixed(2)}</td>
                                            <td>$${totalBalance.toFixed(2)}</td>
                                        `;
                                        
                                        tableBody.appendChild(row);
                                    }
                                    resolve();
                                };
                                
                                staffRequest.onerror = (event) => {
                                    console.error('Error getting staff details:', event.target.error);
                                    reject(event.target.error);
                                };
                            });
                        } catch (error) {
                            console.error('Error processing salesperson ledger:', error);
                        }
                    });
                    
                    return;
                }
                
                // Sort handovers by date
                handovers.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Filter transactions for this salesperson
                const staffTransactions = transactions.filter(t => t.staffId === parseInt(salespersonId));
                
                // Combine handovers and transactions in chronological order
                const ledgerEntries = [];
                
                handovers.forEach(handover => {
                    ledgerEntries.push({
                        type: 'handover',
                        date: new Date(handover.date),
                        data: handover
                    });
                    
                    if (handover.status === 'Returned') {
                        ledgerEntries.push({
                            type: 'return',
                            date: new Date(handover.returnDate || handover.date),
                            data: handover
                        });
                    }
                });
                
                staffTransactions.forEach(transaction => {
                    if (!transaction.description.includes('Sales Shortfall') && 
                        !transaction.description.includes('Sales Overpayment')) {
                        ledgerEntries.push({
                            type: 'transaction',
                            date: new Date(transaction.date),
                            data: transaction
                        });
                    }
                });
                
                // Sort all entries by date
                ledgerEntries.sort((a, b) => a.date - b.date);
                
                // Calculate running balance
                let balance = 0;
                
                // Display ledger entries
                ledgerEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    
                    const date = entry.date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    if (entry.type === 'handover') {
                        const handover = entry.data;
                        
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>Items Handed Over</td>
                            <td>$${handover.totalValue.toFixed(2)}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        `;
                    } else if (entry.type === 'return') {
                        const handover = entry.data;
                        
                        // Calculate the balance change
                        const difference = handover.salesAmount - handover.totalValue;
                        
                        if (difference !== 0) {
                            balance += difference;
                        }
                        
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>Sales Return</td>
                            <td>-</td>
                            <td>$${handover.totalValue.toFixed(2)}</td>
                            <td>$${handover.salesAmount.toFixed(2)}</td>
                            <td>$${balance.toFixed(2)}</td>
                        `;
                    } else if (entry.type === 'transaction') {
                        const transaction = entry.data;
                        
                        // Update balance
                        if (transaction.type === 'Credit') {
                            balance += transaction.amount;
                        } else {
                            balance -= transaction.amount;
                        }
                        
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>${transaction.description}</td>
                            <td>-</td>
                            <td>-</td>
                            <td>${transaction.type === 'Credit' ? '+' : '-'}$${transaction.amount.toFixed(2)}</td>
                            <td>$${balance.toFixed(2)}</td>
                        `;
                    }
                    
                    tableBody.appendChild(row);
                });
                
                // If no entries, show a message
                if (ledgerEntries.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="6" class="text-center">No transactions found for this salesperson.</td>';
                    tableBody.appendChild(row);
                }
            }
        }

        // Generate Report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;
            
            let startDate, endDate;
            
            if (reportPeriod === 'daily') {
                const dateStr = document.getElementById('reportDate').value;
                
                if (!dateStr) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please select a date.'
                    });
                    return;
                }
                
                startDate = new Date(dateStr);
                startDate.setHours(0, 0, 0, 0);
                
                endDate = new Date(dateStr);
                endDate.setHours(23, 59, 59, 999);
            } else if (reportPeriod === 'weekly') {
                const weekStr = document.getElementById('reportWeek').value;
                
                if (!weekStr) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please select a week.'
                    });
                    return;
                }
                
                // Week string format: YYYY-Www (e.g., 2023-W01)
                const year = parseInt(weekStr.substring(0, 4));
                const week = parseInt(weekStr.substring(6, 8));
                
                // Calculate the first day of the week (assuming week starts on Sunday)
                startDate = new Date(year, 0, 1 + (week - 1) * 7);
                startDate.setHours(0, 0, 0, 0);
                
                // Calculate the last day of the week
                endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                endDate.setHours(23, 59, 59, 999);
            } else if (reportPeriod === 'monthly') {
                const monthStr = document.getElementById('reportMonth').value;
                
                if (!monthStr) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Please select a month.'
                    });
                    return;
                }
                
                // Month string format: YYYY-MM
                const year = parseInt(monthStr.substring(0, 4));
                const month = parseInt(monthStr.substring(5, 7)) - 1;
                
                startDate = new Date(year, month, 1);
                startDate.setHours(0, 0, 0, 0);
                
                endDate = new Date(year, month + 1, 0);
                endDate.setHours(23, 59, 59, 999);
            }
            
            // Generate the appropriate report
            if (reportType === 'sales') {
                generateSalesReport(startDate, endDate, reportPeriod);
            } else if (reportType === 'staff') {
                generateStaffReport(startDate, endDate, reportPeriod);
            } else if (reportType === 'inventory') {
                generateInventoryReport(startDate, endDate, reportPeriod);
            }
        }

        // Generate Sales Report
        function generateSalesReport(startDate, endDate, period) {
            const transaction = db.transaction(['bookings', 'salesHandovers'], 'readonly');
            const bookingsStore = transaction.objectStore('bookings');
            const salesHandoversStore = transaction.objectStore('salesHandovers');
            
            // Get all bookings
            const bookingsRequest = bookingsStore.getAll();
            
            bookingsRequest.onsuccess = (event) => {
                const bookings = event.target.result;
                
                // Filter bookings by date
                const filteredBookings = bookings.filter(booking => {
                    const bookingDate = new Date(booking.date);
                    return bookingDate >= startDate && bookingDate <= endDate;
                });
                
                // Get all sales handovers
                const handoversRequest = salesHandoversStore.getAll();
                
                handoversRequest.onsuccess = (event) => {
                    const handovers = event.target.result;
                    
                    // Filter handovers by return date (for completed sales)
                    const filteredHandovers = handovers.filter(handover => {
                        if (handover.status !== 'Returned' || !handover.returnDate) {
                            return false;
                        }
                        
                        const returnDate = new Date(handover.returnDate);
                        return returnDate >= startDate && returnDate <= endDate;
                    });
                    
                    // Calculate totals
                    const totalBookings = filteredBookings.length;
                    const totalRoomSales = filteredBookings.reduce((sum, booking) => sum + booking.amount, 0);
                    const totalBarSales = filteredHandovers.reduce((sum, handover) => sum + handover.salesAmount, 0);
                    const totalSales = totalRoomSales + totalBarSales;
                    
                    // Generate report content
                    const periodText = getPeriodText(period, startDate, endDate);
                    
                    const reportContent = `
                        <div class="report-container">
                            <h2>Sales Report - ${periodText}</h2>
                            
                            <div class="report-summary">
                                <div class="summary-item">
                                    <h3>Total Bookings</h3>
                                    <p>${totalBookings}</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Room Sales</h3>
                                    <p>$${totalRoomSales.toFixed(2)}</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Bar Sales</h3>
                                    <p>$${totalBarSales.toFixed(2)}</p>
                                </div>
                                <div class="summary-item">
                                    <h3>Total Revenue</h3>
                                    <p>$${totalSales.toFixed(2)}</p>
                                </div>
                            </div>
                            
                            <div class="report-details">
                                <h3>Room Bookings</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Room</th>
                                            <th>Guest</th>
                                            <th>Duration</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredBookings.length === 0 ? 
                                            '<tr><td colspan="5" class="text-center">No bookings in this period.</td></tr>' : 
                                            filteredBookings.map(booking => {
                                                const date = new Date(booking.date).toLocaleDateString('en-US', {
                                                    year: 'numeric',
                                                    month: 'short',
                                                    day: 'numeric'
                                                });
                                                return `
                                                    <tr>
                                                        <td>${date}</td>
                                                        <td>${booking.roomNumber}</td>
                                                        <td>${booking.guestName}</td>
                                                        <td>${booking.duration} days</td>
                                                        <td>$${booking.amount.toFixed(2)}</td>
                                                    </tr>
                                                `;
                                            }).join('')
                                        }
                                    </tbody>
                                </table>
                                
                                <h3>Bar Sales</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Salesperson</th>
                                            <th>Items Value</th>
                                            <th>Sales Amount</th>
                                            <th>Difference</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredHandovers.length === 0 ? 
                                            '<tr><td colspan="5" class="text-center">No bar sales in this period.</td></tr>' : 
                                            filteredHandovers.map(handover => {
                                                const date = new Date(handover.returnDate).toLocaleDateString('en-US', {
                                                    year: 'numeric',
                                                    month: 'short',
                                                    day: 'numeric'
    </script>
</body>
</html>